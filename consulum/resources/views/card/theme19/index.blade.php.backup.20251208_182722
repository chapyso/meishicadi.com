
@php


    $social_no = 1;
    $appointment_no = 0;
    $service_row_no = 0;
    $product_row_no = 0;
    $testimonials_row_no = 0;
    $gallery_row_no = 0;
    $path = isset($business->banner) && !empty($business->banner) ? asset(Storage::url('card_banner/' . $business->banner)) : asset('custom/img/placeholder-image.jpg');
    $no = 1;
    $stringid = $business->id;
    $is_enable = false;
    $is_contact_enable = false;
    $is_enable_appoinment = false;
    $is_enable_service = false;
    $is_enable_product = false;
    $is_enable_testimonials = false;
    $is_enable_sociallinks = false;
    $is_custom_html_enable = false;
    $is_enable_gallery = false;
    $custom_html = $business->custom_html_text;
    $is_branding_enabled = false;
    $branding = $business->branding_text;
    $is_gdpr_enabled = false;
    $gdpr_text = $business->gdpr_text;
    $card_theme = json_decode($business->card_theme);
     
    $banner = \App\Models\Utility::get_file('card_banner');
    $logo = \App\Models\Utility::get_file('card_logo');
    $image = \App\Models\Utility::get_file('testimonials_images');
    $s_image = \App\Models\Utility::get_file('service_images');
    $pr_image = \App\Models\Utility::get_file('product_images');
    $company_favicon = Utility::getsettingsbyid($business->created_by);
    $company_favicon = $company_favicon['company_favicon'];
    $logo1 = \App\Models\Utility::get_file('uploads/logo/');
    $meta_image = \App\Models\Utility::get_file('meta_image');
    $gallery_path = \App\Models\Utility::get_file('gallery');
    $qr_path = \App\Models\Utility::get_file('qrcode');
    
    
  
    
    if (!is_null($business_hours) && !is_null($businesshours)) {
        $businesshours['is_enabled'] == '1' ? ($is_enable = true) : ($is_enable = false);
    }
    if (!is_null($contactinfo) && !is_null($contactinfo)) {
        $contactinfo['is_enabled'] == '1' ? ($is_contact_enable = true) : ($is_contact_enable = false);
    }
    
    if (!is_null($appoinment_hours) && !is_null($appoinment)) {
        $appoinment['is_enabled'] == '1' ? ($is_enable_appoinment = true) : ($is_enable_appoinment = false);
    }
    
    if (!is_null($services_content) && !is_null($services)) {
        $services['is_enabled'] == '1' ? ($is_enable_service = true) : ($is_enable_service = false);
    }
    if (!is_null($products_content) && !is_null($products)) {
        $products['is_enabled'] == '1' ? ($is_enable_product = true) : ($is_enable_product = false);
    }
    
    if (!is_null($testimonials_content) && !is_null($testimonials)) {
        $testimonials['is_enabled'] == '1' ? ($is_enable_testimonials = true) : ($is_enable_testimonials = false);
    }
    
    if (!is_null($social_content) && !is_null($sociallinks)) {
        $sociallinks['is_enabled'] == '1' ? ($is_enable_sociallinks = true) : ($is_enable_sociallinks = false);
    }
    
    if (!is_null($gallery_contents) && !is_null($gallery)) {
        $gallery['is_enabled'] == '1' ? ($is_enable_gallery = true) : ($is_enable_gallery = false);
    }
    
    if (!is_null($custom_html) && !is_null($customhtml)) {
        $customhtml->is_custom_html_enabled == '1' ? ($is_custom_html_enable = true) : ($is_custom_html_enable = false);
    }
    if (!is_null($business->is_branding_enabled) && !is_null($business->is_branding_enabled)) {
        !empty($business->is_branding_enabled) && $business->is_branding_enabled == 'on' ? ($is_branding_enabled = true) : ($is_branding_enabled = false);
    } else {
        $is_branding_enabled = false;
    }
    if (!is_null($business->is_gdpr_enabled) && !is_null($business->is_gdpr_enabled)) {
        !empty($business->is_gdpr_enabled) && $business->is_gdpr_enabled == 'on' ? ($is_gdpr_enabled = true) : ($is_gdpr_enabled = false);
    }
    
        $is_map_iframe_enabled = false;
    $map_iframe = $business->map_iframe;
    if (!is_null($customhtml)) {
        isset($customhtml->is_map_iframe_enabled) && $customhtml->is_map_iframe_enabled == '1' ? ($is_map_iframe_enabled = true) : ($is_map_iframe_enabled = false);
    } else if (isset($business->is_map_iframe_enabled) && $business->is_map_iframe_enabled == '1') {
        $is_map_iframe_enabled = true;
    }
      
      
    $color = substr($business->theme_color, 0, 6);
    $SITE_RTL = Cookie::get('SITE_RTL');
    if ($SITE_RTL == '') {
        $SITE_RTL = 'off';
    }
    $SITE_RTL = Utility::settings()['SITE_RTL'];
    $url_link = env('APP_URL') . '/' . $business->slug;
    $meta_tag_image = $meta_image . '/' . $business->meta_image;
    // Cookie
    $cookie_data = App\Models\Business::card_cookie($business->slug);
    $a = $cookie_data;
   
    if(isset($ds_lang_btns) && $ds_lang_btns == "true"){
        // Store original English values before any modification
        $original_title = $business->title;
        $original_sub_title = $business->sub_title;
        $original_description = $business->description;
        $original_designation = $business->designation;
        
        $SITE_RTL = 'off';
        $dslang = request()->query('lang');
        
        // Default to English if no language parameter is provided
        if(!isset($dslang) || $dslang == ''){
            $dslang = 'en';
        }
        
        // Check if card has Arabic content
        $has_arabic = !empty($business->ar_title) || !empty($business->ar_sub_title) || !empty($business->ar_description) || !empty($business->ar_designation);
        // Check if card has English content  
        $has_english = !empty($business->title) || !empty($business->sub_title) || !empty($business->description) || !empty($business->designation);
        
        // Only use Arabic if explicitly requested and Arabic content exists
        if($dslang == "ar" && $has_arabic){
            $SITE_RTL = 'on';
            App::setLocale("ar");
            // Use Arabic content
            $business->title = $business->ar_title ?: $original_title;
            $business->sub_title = $business->ar_sub_title ?: $original_sub_title;
            $business->description = $business->ar_description ?: $original_description;
            $business->designation = $business->ar_designation ?: $original_designation;
            // Show English button if English content exists
            if($has_english){
                $dslang_url = Request::url()."?lang=en";
                $dslang_text = "English";
            }
        } else {
            // Default to English (when lang=en or no lang param), use English content
            $SITE_RTL = 'off';
            App::setLocale("en");
            // Ensure we're using English content (original values)
            $business->title = $original_title;
            $business->sub_title = $original_sub_title;
            $business->description = $original_description;
            $business->designation = $original_designation;
            // Show Arabic button if Arabic content exists
            if($has_arabic){
                $dslang_url = Request::url()."?lang=ar";
                $dslang_text = "عربي";
            }
        }
    }
    

@endphp
<!DOCTYPE html>
<html dir="{{ $SITE_RTL == 'on' ? 'rtl' : '' }}">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <!-- Disable Android WebView auto-resizing -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>{{ $business->title }}</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="HandheldFriendly" content="True">
    <meta name="author" content="{{ $business->title }}">
    <meta name="keywords" content="{{ $business->meta_keyword }}">
    <meta name="description" content="{{ $business->meta_description }}">

    {{-- Meta tag Preview --}}
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ $url_link }}">
    <meta property="og:title" content="{{ $business->title }}">
    <meta property="og:description" content="{{ $business->meta_description }}">
    <meta property="og:image"
        content="{{ !empty($business->meta_image) ? $meta_tag_image : asset('custom/img/placeholder-image.jpg') }}">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ $url_link }}">
    <meta property="twitter:title" content="{{ $business->title }}">
    <meta property="twitter:description" content="{{ $business->meta_description }}">
    <meta property="twitter:image"
        content="{{ !empty($business->meta_image) ? $meta_tag_image : asset('custom/img/placeholder-image.jpg') }}">
    {{-- End Meta tag Preview --}}

    <link rel="icon"
        href="{{ rtrim($logo1, '/') . '/' . (!empty($company_favicon) ? $company_favicon : 'favicon.png') }}"
        type="image/png" sizes="16x16">
    {{-- Preload critical CSS --}}
    <link rel="preload" href="{{ asset('custom/theme19/libs/@fortawesome/fontawesome-free/css/all.min.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ asset('custom/theme19/libs/@fortawesome/fontawesome-free/css/all.min.css') }}"></noscript>
    
    <link rel="stylesheet" href="{{ asset('custom/theme19/fonts/stylesheet.css') }}">
    <link rel="preload" href="{{ asset('assets/css/plugins/animate.min.css') }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ asset('assets/css/plugins/animate.min.css') }}"></noscript>
    @if (isset($is_slug))
        <link rel="stylesheet" href="{{ asset('custom/theme19/modal/bootstrap.min.css') }}">
    @endif

    @if ($SITE_RTL == 'on')
        <link rel="stylesheet" href="{{ asset('custom/theme19/css/rtl-main-style.css') }}?t={{ time() }}">
        <link rel="stylesheet" href="{{ asset('custom/theme19/css/rtl-responsive.css') }}">
    @else
        <link rel="stylesheet" href="{{ asset('custom/theme19/css/main-style.css') }}?t={{ time() }}">
        <link rel="stylesheet" href="{{ asset('custom/theme19/css/responsive.css') }}">
    @endif
    {{-- Always import Montserrat as default font --}}
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
    </style>
    @if(!isset($business->google_fonts))
        @php $business->google_fonts = "Montserrat"; @endphp
    @endif
    @if ($business->google_fonts != 'Default' && isset($business->google_fonts))
        <style>
            @import url('{{ \App\Models\Utility::getvalueoffont($business->google_fonts)['link'] }}');
            
            :root .theme19-v1 {
                --Strawford: '{{ strtok(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') }}', {{ substr(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], strpos(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') + 1) }};
            }

            :root .theme19-v2 {
                --Strawford: '{{ strtok(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') }}', {{ substr(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], strpos(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') + 1) }};
            }

            :root .theme19-v3 {
                --Strawford: '{{ strtok(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') }}', {{ substr(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], strpos(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') + 1) }};
            }

            :root .theme19-v4 {
                --Strawford: '{{ strtok(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') }}', {{ substr(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], strpos(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') + 1) }};
            }

            :root .theme19-v5 {
                --Strawford: '{{ strtok(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') }}', {{ substr(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], strpos(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') + 1) }};
            }
            :root .theme19-v6 {
                --Strawford: '{{ strtok(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') }}', {{ substr(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], strpos(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') + 1) }};
            }
            :root .theme19-v7 {
                --Strawford: '{{ strtok(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') }}', {{ substr(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], strpos(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') + 1) }};
            }
            :root .theme19-v8 {
                --Strawford: '{{ strtok(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') }}', {{ substr(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], strpos(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') + 1) }};
            }
            :root .theme19-v9 {
                --Strawford: '{{ strtok(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') }}', {{ substr(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], strpos(\App\Models\Utility::getvalueoffont($business->google_fonts)['fontfamily'], ',') + 1) }};
            }
        </style>
    @endif

    @if (isset($is_slug))
        <link rel='stylesheet' href='{{ asset('css/cookieconsent.css') }}' media="screen" />
        <style type="text/css">
            {{ $business->customcss }}
        </style>
    @endif

    {{-- Modern Dark Theme CSS for Make Contact Form --}}
    <style>
        /* Container centering */
        #view_css .contact-popup .container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Modal dialog */
        #view_css .modal-dialog {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding: 0 12px;
        }

        /* Modal container */
        #view_css .contact-modal-dark {
            background: #0f0f0f;
            border-radius: 16px;
            padding: 15px;
            width: 100%;
            margin: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: calc(100vh - 32px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Inputs */
        #view_css .contact-input {
            background: #1a1a1a;
            border: 1px solid #2d2d2d;
            border-radius: 10px;
            padding: 12px 14px;
            color: #fff !important;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        #view_css .contact-input::placeholder {
            color: #8e8e8e;
        }

        #view_css .contact-input:focus {
            border-color: #4c8bf5;
            box-shadow: 0 0 0 2px rgba(76,139,245,0.3);
            background: #1a1a1a;
            color: #fff !important;
            outline: none;
        }

        /* Buttons */
        #view_css .contact-btn {
            background: #333;
            border: none;
            color: #fff;
            padding: 10px 18px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        #view_css .contact-btn:hover {
            background: #444;
            color: #fff;
        }

        #view_css .contact-btn-primary {
            background: #4c8bf5;
            color: #fff;
            font-weight: 600;
            border-radius: 10px;
            padding: 10px 20px;
            border: none;
            transition: all 0.3s ease;
        }

        #view_css .contact-btn-primary:hover {
            background: #3b73cf;
            color: #fff;
        }

        /* Close icon */
        #view_css .btn-close-white {
            filter: invert(1);
            opacity: 0.8;
        }

        #view_css .btn-close-white:hover {
            opacity: 1;
        }

        /* Modal dialog centering */
        #view_css .modal-dialog-centered {
            display: flex;
            align-items: center;
            min-height: calc(100% - 2rem);
        }

        /* Text colors */
        #view_css .text-white {
            color: #fff !important;
        }

        #view_css .text-light {
            color: #e0e0e0 !important;
        }

        /* Modal body padding */
        #view_css .contact-modal-dark .modal-body {
            padding: 20px;
            overflow-y: auto;
        }

        /* Modal header */
        #view_css .contact-modal-dark .modal-header {
            padding: 20px 20px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Modal footer */
        #view_css .contact-modal-dark .modal-footer {
            padding: 15px 20px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            gap: 12px;
        }

        /* Error messages */
        #view_css .contact-modal-dark .text-danger {
            color: #ff6b6b !important;
            font-size: 0.85rem;
            margin-top: 4px;
            display: block;
        }

        /* Form label styling */
        #view_css .contact-modal-dark .form-label {
            font-weight: 500;
            margin-bottom: 8px;
            display: block;
        }

        /* Responsive modal */
        @media (max-width: 768px) {
            #view_css .contact-popup .container {
                align-items: flex-start;
                padding: 12px 10px;
            }

            #view_css .modal-responsive {
                margin: 0;
                width: 100% !important;
                max-width: 100%;
            }

            #view_css .modal-dialog {
                max-width: 520px;
                padding: 0 6px;
            }

            #view_css .contact-modal-dark {
                border-radius: 12px;
                width: 100%;
                padding: 12px;
                max-height: calc(100vh - 20px);
            }

            #view_css .contact-modal-dark .modal-header,
            #view_css .contact-modal-dark .modal-body,
            #view_css .contact-modal-dark .modal-footer {
                padding: 12px;
            }

            #view_css .contact-modal-dark .modal-footer {
                flex-direction: column;
                align-items: stretch;
            }

            #view_css .contact-modal-dark .modal-footer .btn {
                width: 100%;
            }
        }
    </style>

    {{-- pwa customer app --}}
    <meta name="mobile-wep-app-capable" content="yes">
    <meta name="apple-mobile-wep-app-capable" content="yes">
    <meta name="msapplication-starturl" content="/">
    <link rel="apple-touch-icon"
        href="{{ asset(Storage::url('uploads/logo/') . (!empty($setting->value) ? $setting->value : 'favicon.png')) }}" />
    @if ($business->enable_pwa_business == 'on' && $plan->pwa_business == 'on')
        <link rel="manifest"
            href="{{ asset('storage/uploads/theme_app/business_' . $business->id . '/manifest.json') }}" />
    @endif
    @if (!empty($business->pwa_business($business->slug)->theme_color))
        <meta name="theme-color" content="{{ $business->pwa_business($business->slug)->theme_color }}" />
    @endif
    @if (!empty($business->pwa_business($business->slug)->background_color))
        <meta name="apple-mobile-web-app-status-bar"
            content="{{ $business->pwa_business($business->slug)->background_color }}" />
    @endif
    @foreach ($pixelScript as $script)
        <?= $script ?>
    @endforeach
</head>

 
 <style>
 
 #directions-button {
     background-color: var(--theme-color) !important;
     color: var(--white) !important;
     font-family: Montserrat;
     font-weight: bold !important;
     padding: 8px 16px !important;
     border: 2px solid var(--theme-color) !important;
     border-radius: 20px !important;
     /* Curved edges */
     cursor: pointer !important;
 }
 
 #directions-button:hover {
     background-color: var(--white);
     color: var(--theme-color);
 }

 </style>
 
<style>
    
    .map_iframe{ 
        margin: 10px auto 20px auto;
        background: transparent !important;
    }
    
    
    #339_chtml_preview{
        /*padding:0px 10px;*/
    }
</style>

<style>
    /* Unified Business Profile Styles - Identical on iOS and Android */
    .business-profile-container {
        -webkit-text-size-adjust: 100% !important;
        -moz-text-size-adjust: 100% !important;
        -ms-text-size-adjust: 100% !important;
        text-size-adjust: 100% !important;
    }
    
    /* Fixed header structure - prevents Android collapse */
    .profile-header {
        display: flex !important;
        flex-direction: column !important;
        width: 100% !important;
        flex-shrink: 0 !important;
        flex-grow: 0 !important;
        min-height: auto !important;
        max-height: none !important;
    }
    
    /* Unified contact card styles - identical on all devices */
    .contact-card,
    .client-contact .contactlink {
        width: 100% !important;
        max-width: 100% !important;
        min-width: 0 !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        margin-bottom: 15px !important;
        padding: 0 !important;
        flex-shrink: 0 !important;
        flex-grow: 0 !important;
        box-sizing: border-box !important;
    }
    
    .contact-card a,
    .client-contact .contactlink a {
        width: 100% !important;
        padding: 16px 20px !important;
        border-radius: 12px !important;
        margin-bottom: 0 !important;
        box-sizing: border-box !important;
        background: #ffffff !important;
        border: none !important;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
    }
    
    /* Fixed icon size - identical on all devices */
    .contact-card .contact-icon,
    .client-contact .contactlink a .contact-icon {
        font-size: 24px !important;
        width: 26px !important;
        height: 26px !important;
        min-width: 26px !important;
        max-width: 26px !important;
        min-height: 26px !important;
        max-height: 26px !important;
        flex-shrink: 0 !important;
        flex-grow: 0 !important;
    }
    
    /* Fixed text sizes - identical on all devices - match iOS */
    .contact-card .contact-text span,
    .client-contact .contactlink a .contact-text span {
        font-size: 18px !important;
        font-weight: 700 !important;
        letter-spacing: 0 !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif !important;
    }
    
    .contact-card .contact-text .contact-label,
    .client-contact .contactlink a .contact-text .contact-label {
        font-size: 12px !important;
        color: #666666 !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif !important;
    }
    
    /* Separate styling for client-contact section */
    .client-contact {
        /* Container styles if needed */
    }
    
    .client-contact .contactlink a.theme-text {
        color: #000000 !important;
    }
    
    .client-contact .contactlink a.theme-text:hover {
        color: #000000 !important;
        opacity: 0.8;
    }
    
    .client-contact .contact-text span {
        color: #000000 !important;
    }
    
    .client-contact .contact-label {
        color: #000000 !important;
    }
    
    .client-contact .contact-icon {
        color: #000000 !important;
    }
    
    /* Disable Android WebView auto-resizing */
    * {
        -webkit-text-size-adjust: 100% !important;
        -moz-text-size-adjust: 100% !important;
        -ms-text-size-adjust: 100% !important;
        text-size-adjust: 100% !important;
    }
    
    /* MOBILE ONLY: Prevent horizontal scrolling and ensure consistent layout */
    @media screen and (max-width: 768px) {
        #view_css .home-wrapper,
        #view_css .business-profile-container {
            max-width: 100% !important;
            overflow-x: hidden !important;
            box-sizing: border-box !important;
        }
        
        /* Ensure action buttons don't stick together */
        #view_css .banner-social-icons li a span {
            white-space: normal !important;
            word-wrap: break-word !important;
            word-break: break-word !important;
            overflow-wrap: break-word !important;
        }
        
        /* Prevent text overflow in contact cards */
        .contact-card .contact-text span,
        #view_css .client-contact .contactlink a .contact-text span {
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            word-break: break-word !important;
        }
        
        /* Ensure bottom buttons match iOS exactly - smaller on Android */
        #view_css .more-card-second-section .more-card-btn {
            overflow-x: hidden !important;
            align-items: stretch !important;
        }
        
        #view_css .more-card-second-section .more-card-btn .btn {
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            background: #000000 !important;
            color: #ffffff !important;
            padding: 12px 14px !important;
            border-radius: 12px !important;
            min-height: 44px !important;
            gap: 6px !important;
            font-size: 13px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        #view_css .more-card-second-section .more-card-btn .btn svg {
            height: 18px !important;
            width: 18px !important;
            fill: #ffffff !important;
            flex-shrink: 0 !important;
        }
        
        #view_css .more-card-second-section .more-card-btn .btn svg path,
        #view_css .more-card-second-section .more-card-btn .btn svg * {
            fill: #ffffff !important;
            stroke: #ffffff !important;
        }
        
        /* Android-specific smaller buttons */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            #view_css .more-card-second-section .more-card-btn .btn {
                padding: 11px 12px !important;
                font-size: 12px !important;
                min-height: 42px !important;
                gap: 5px !important;
            }
            
            #view_css .more-card-second-section .more-card-btn .btn svg {
                height: 16px !important;
                width: 16px !important;
            }
        }
        
        /* Android device class - ensure text and icons fit without being cut */
        body.android-device #view_css .more-card-second-section .more-card-btn .btn {
            padding: 10px 10px !important;
            font-size: 11px !important;
            min-height: 40px !important;
            gap: 4px !important;
            line-height: 1.2 !important;
            letter-spacing: -0.2px !important;
            overflow: visible !important;
            text-overflow: clip !important;
            white-space: normal !important;
            word-wrap: break-word !important;
        }
        
        body.android-device #view_css .more-card-second-section .more-card-btn .btn svg {
            height: 14px !important;
            width: 14px !important;
            min-width: 14px !important;
            min-height: 14px !important;
            max-width: 14px !important;
            max-height: 14px !important;
        }
        
        /* Make Connection button - ensure icon and text fit properly */
        #view_css .more-card-second-section .more-card-btn .btn.our-contact {
            padding: 12px 10px !important;
            font-size: 12px !important;
            white-space: normal !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            line-height: 1.2 !important;
            text-align: center !important;
        }
        
        body.android-device #view_css .more-card-second-section .more-card-btn .btn.our-contact {
            padding: 9px 7px !important;
            font-size: 10px !important;
            min-height: 38px !important;
            gap: 3px !important;
            line-height: 1.1 !important;
            letter-spacing: -0.3px !important;
        }
        
        body.android-device #view_css .more-card-second-section .more-card-btn .btn.our-contact svg {
            height: 12px !important;
            width: 12px !important;
            min-width: 12px !important;
            min-height: 12px !important;
            max-width: 12px !important;
            max-height: 12px !important;
        }
    }
</style>

<script>
/* Detect Android and add class to body for CSS targeting */
(function() {
    // Wait for DOM to be ready before accessing body
    function addDeviceClass() {
        if (document.body) {
            var isAndroid = /Android/i.test(navigator.userAgent);
            if (isAndroid) {
                document.body.classList.add('android-device');
            } else {
                document.body.classList.add('ios-device');
            }
        } else {
            // Retry if body not ready yet
            setTimeout(addDeviceClass, 50);
        }
    }
    // Try immediately, fallback to DOMContentLoaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', addDeviceClass);
    } else {
        addDeviceClass();
    }
})();

/* Make text black on light backgrounds and white on dark backgrounds */
/* This uses JavaScript to dynamically adjust text color based on background luminance */
(function() {
    function getLuminance(rgb) {
        // Extract RGB values from various formats
        let r, g, b;
        if (rgb.startsWith('rgb')) {
            const matches = rgb.match(/\d+/g);
            if (matches && matches.length >= 3) {
                r = parseInt(matches[0]);
                g = parseInt(matches[1]);
                b = parseInt(matches[2]);
            }
        } else if (rgb.startsWith('#')) {
            r = parseInt(rgb.substr(1, 2), 16);
            g = parseInt(rgb.substr(3, 2), 16);
            b = parseInt(rgb.substr(5, 2), 16);
        }
        
        if (r === undefined) return null;
        
        // Calculate relative luminance using the sRGB formula
        const [rs, gs, bs] = [r, g, b].map(val => {
            val = val / 255;
            return val <= 0.03928 ? val / 12.92 : Math.pow((val + 0.055) / 1.055, 2.4);
        });
        
        return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
    }
    
    function adjustTextColor(element) {
        const bgColor = window.getComputedStyle(element).backgroundColor;
        const luminance = getLuminance(bgColor);
        
        if (luminance !== null) {
            // If background is light (luminance > 0.5), use black text
            // If background is dark (luminance <= 0.5), use white text
            element.style.color = luminance > 0.5 ? '#000000' : '#ffffff';
        }
    }
    
    function applyTextColorAdjustments() {
        // Apply to all elements
        const allElements = document.querySelectorAll('*');
        allElements.forEach(el => {
            const bgColor = window.getComputedStyle(el).backgroundColor;
            if (bgColor && bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
                adjustTextColor(el);
            }
        });
    }
    
    // Run on page load
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', applyTextColorAdjustments);
    } else {
        applyTextColorAdjustments();
    }
    
    // Also run after a short delay to catch dynamically loaded content
    setTimeout(applyTextColorAdjustments, 500);
})();
</script>
<body class="tech-card-body">
    <!--wrapper start here-->
    <div id="boxes">
        <div id="view_css"
            class="{{ \App\Models\Utility::themeOne()['theme19'][$business->theme_color]['theme_name'] ?? \App\Models\Utility::themeOne()['theme19']['color7-theme19']['theme_name'] ?? 'theme19-v7' }}">
            <div class="home-wrapper business-profile-container">
                <section class="home-banner-section padding-top profile-header">

                    @if(isset($ds_lang_btns) && $ds_lang_btns == "true" && isset($dslang_url) && isset($dslang_text) && (!empty($business->ar_title) || !empty($business->ar_sub_title) || !empty($business->ar_description) || !empty($business->ar_designation)))
                        <section class="ds_lang_buttons text-right">
                            <a href="{{ $dslang_url }}" class="dsLangBtn">{{ $dslang_text }}</a>
                        </section>
                    @endif
                    <div class="container">
                        <div class="client-intro">
                            <div class="client-image">
                                <img src="{{ isset($business->logo) && !empty($business->logo) ? preg_replace('#([^:])//+#', '$1/', rtrim($logo, '/') . '/' . ltrim($business->logo, '/')) : asset('custom/img/logo-placeholder-image-2.png') }}"
                                    id="business_logo_preview" alt="image" loading="eager" fetchpriority="high">
                            </div>
                            <div class="client-brief-info text-center">
                                <h3 id="{{ $stringid . '_title' }}_preview">{{ $business->title }}</h3>
                                <h6 id="{{ $stringid . '_designation' }}_preview">{{ $business->designation }}</h6>
                                <span id="{{ $stringid . '_subtitle' }}_preview">{{ $business->sub_title }}</span>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="top-social-section profile-header">
                    <div class="container" id="contact-div1">
                        <ul class="banner-social-icons" id="inputrow_contact_preview1">
                            @if (!is_null($contactinfo_content) && !is_null($contactinfo))
                                @foreach ($contactinfo_content as $key => $val)
                                    @foreach ($val as $key1 => $val1)
                                        @php
                                            // Ensure $val1 is a string
                                            $val1_str = is_object($val1) ? json_encode($val1) : (string)$val1;
                                        @endphp
                                        @if ($key1 == 'Phone')
                                            @php $href = 'tel:'.$val1_str; @endphp
                                        @elseif($key1 == 'Email')
                                            @php $href = 'mailto:'.$val1_str; @endphp
                                        @elseif($key1 == 'Address')
                                            @php $href = '#'; @endphp
                                        @elseif($key1 == 'Telephone')
                                            @php $href = 'tel:'.$val1_str; @endphp
                                        @elseif($key1 == 'Fax')
                                            @php $href = 'fax:'.$val1_str; @endphp
                                        @elseif($key1 == 'Web_url')
                                            @if (!preg_match("~^(?:f|ht)tps?://~i", $val1_str))
                                                @php $href = "http://" . $val1_str; @endphp
                                            @else
                                                @php $href = $val1_str; @endphp
                                            @endif
                                        @else
                                            @php $href = $val1_str; @endphp
                                        @endif

                                        @if ($key1 != 'id')
                                               @php 
                                                // Map contact types to modern Font Awesome icons for header buttons
                                                // Using solid icons for better visibility and consistency, RTL-compatible
                                                $icon_class_header = '';
                                                if ($key1 == 'Email') {
                                                    $icon_class_header = 'fas fa-envelope'; // Modern solid envelope icon
                                                } elseif ($key1 == 'Phone') {
                                                    $icon_class_header = 'fas fa-mobile-alt'; // Mobile phone icon - works in both FA 5 and 6
                                                } elseif ($key1 == 'Telephone') {
                                                    $icon_class_header = 'fas fa-phone'; // Classic telephone icon - universally compatible
                                                } elseif ($key1 == 'Web_url') {
                                                    $icon_class_header = 'fas fa-globe'; // Globe icon - universally compatible
                                                } elseif ($key1 == 'Address' || $key1 == 'Location') {
                                                    $icon_class_header = 'fas fa-map-marker-alt'; // Location pin icon - universally compatible
                                                } elseif ($key1 == 'Fax') {
                                                    $icon_class_header = 'fas fa-fax'; // Fax icon
                                                } elseif ($key1 == 'Whatsapp') {
                                                    $icon_class_header = 'fab fa-whatsapp'; // WhatsApp brand icon
                                                } else {
                                                    $icon_class_header = 'fas fa-circle'; // Default solid circle
                                                }
                                            @endphp
                                            <li id="contact1_{{ $loop->parent->index + 1 }}">
                                                    @if ($key1 == 'Whatsapp')
                                                        <a href="{{ url('https://wa.me/' . $href) }}"
                                                            target="_blank">
                                                            <i class="{{ $icon_class_header }} banner-icon"></i>
                                                    @else
                                                        <a href="{{ $href }}">
                                                            <i class="{{ $icon_class_header }} banner-icon"></i>
                                                    @endif
                                                    @if($key1 == 'Phone')
                                                    <span>{{ __('Mobile') }}</span>
                                                    @elseif($key1 == 'Website' || $key1 == 'Web_url')
                                                    <span>{{ __('Website') }}</span>
                                                    @else
                                                    <span>{{ __($key1) }}</span>
                                                    @endif
                                                    </a>
                                            </li>
                                        @endif
                                        @php
                                            $no++;
                                        @endphp
                                    @endforeach
                                @endforeach
                            @endif
                        </ul>
                    </div>
                </section>
                @php $j = 1; @endphp
       
                @foreach ($card_theme->order as $order_key => $order_value)
                    @if ($j == $order_value)

                        @if ($order_key == 'description')
                            <section class="contact-info-section padding-top">
                                <div class="container">
                                    <div class="client-intro">
                                        <div class="client-brief-intro">
                                            <p id="{{ $stringid . '_desc' }}_preview">
                                                {{ str_replace('Government Advisory', '', $business->description ?? '') }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        @endif
                        @if ($order_key == 'bussiness_hour')
                        @if(isset($businesshours)&& $businesshours['is_enabled']==1 )
                            <section class="business-hour-section padding-top" id="business-hours-div">
                                <div class="container">
                                    <div class="section-title text-center">
                                        <h2>{{ __('Business Hours') }}</h2>
                                    </div>
                                    <div class="daily-hours-content">
                                        <div class="daily-hours-inner">
                                            <ul class="pl-1">
                                                @foreach ($days as $k => $day)
                                                    <li>
                                                        <p>{{ __($day) }}:<span
                                                                class="days_{{ $k }}">
                                                                @if (isset($business_hours->$k) && $business_hours->$k->days == 'on')
                                                                    <span
                                                                        class="days_{{ $k }}_start">{{ !empty($business_hours->$k->start_time) && isset($business_hours->$k->start_time) ? date('h:i A', strtotime($business_hours->$k->start_time)) : '00:00' }}</span>
                                                                    - <span
                                                                        class="days_{{ $k }}_end">{{ !empty($business_hours->$k->end_time) && isset($business_hours->$k->end_time) ? date('h:i A', strtotime($business_hours->$k->end_time)) : '00:00' }}</span>
                                                                @else
                                                                    {{ __('Closed') }}
                                                                @endif
                                                            </span></p>
                                                    </li>
                                                @endforeach
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        @endif    
                        @endif
                        @if ($order_key == 'appointment')
                  
                        @if(isset($appoinment)&& $appoinment['is_enabled']==1 )
                            <section id="appointment-div" class="appointment-section padding-top">
                                <div class="container">
                                    <div class="section-title text-center">
                                        <h2><b>{{ __('Make an') }}</b> {{ __('appointment') }}</h2>
                                    </div>
                                    <form class="appointment-detail">
                                        <div class="app-date form-group">
                                            <label>{{ __('Date') }}:</label>
                                            <input type="text" name="date" class="form-control datepicker_min"
                                                placeholder="{{ __('Pick a Date') }}">
                                        </div>
                                        <div class="app-hour form-group" id="inputrow_appointment_preview">
                                            <label>{{ __('Hour:') }}</label>
                                            <select class="form-control app_select time">
                                                <option id="">{{ __('Select hour') }}</option>
                                                @if (!is_null($appoinment_hours))
                                                    @foreach ($appoinment_hours as $k => $hour)
                                                        <option id="{{ 'appointment_' . $appointment_no }}">
                                                            <span id="appoinment_start_{{ $appointment_no }}_preview">
                                                                @if (!empty($hour->start))
                                                                    {{ $hour->start }}
                                                                @else
                                                                    00:00
                                                                @endif
                                                            </span> - <span
                                                                id="appoinment_end_{{ $appointment_no }}_preview">
                                                                @if (!empty($hour->end))
                                                                    {{ $hour->end }}
                                                                @else
                                                                    00:00
                                                                @endif
                                                            </span>
                                                        </option>
                                                    @endforeach
                                                @endif
                                            </select>
                                        </div>
                                    </form>
                                    <div class="w-100 mt-0">
                                        <span class="text-danger span-error-date"></span>
                                    </div>
                                    <div class="text-center mt-0 mb-3 col-12">
                                        <span class="text-danger text-center span-error-time"></span>
                                    </div>
                                    <div class="appointment-btn">
                                        <a href="javascript:;" data-toggle="modal" data-target="#appointment-modal"
                                            class="btn" tabindex="0">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                viewBox="0 0 20 20" fill="none">
                                                <path class="theme-svg" fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M4 1C4 0.447715 4.44772 0 5 0C5.55228 0 6 0.447715 6 1V2H14V1C14 0.447715 14.4477 0 15 0C15.5523 0 16 0.447715 16 1V2H17C18.6569 2 20 3.34315 20 5V17C20 18.6569 18.6569 20 17 20H3C1.34315 20 0 18.6569 0 17V5C0 3.34315 1.34315 2 3 2H4V1Z"
                                                    fill="white" />
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M8 10C7.44772 10 7 10.4477 7 11C7 11.5523 7.44772 12 8 12H15C15.5523 12 16 11.5523 16 11C16 10.4477 15.5523 10 15 10H8ZM5 14C4.44772 14 4 14.4477 4 15C4 15.5523 4.44772 16 5 16H11C11.5523 16 12 15.5523 12 15C12 14.4477 11.5523 14 11 14H5Z"
                                                    fill="white" />
                                            </svg>
                                            {{ __('Make an appointment') }}
                                        </a>
                                    </div>
                                </div>

                            </section>
                        @endif
                       @endif
                        @if ($order_key == 'service')
                         @if(isset($services)&& $services['is_enabled']==1 )
                            <section class="service-section padding-top padding-bottom" id="services-div">
                                <div class="container">
                                    <div class="section-title text-center">
                                        <h2>{{ __('Services') }}</h2>
                                    </div>

                                    <div class="service-card-wrapper" id="inputrow_service_preview">
                                        @php $image_count = 0; @endphp
                                        @foreach ($services_content as $k1 => $content)
                                            <div class="service-card" id="services_{{ $service_row_no }}">
                                                <div class="service-card-inner">
                                                    <div class="service-icon testimonials_image">
                                                        <img id="{{ 's_image' . $image_count . '_preview' }}"
                                                            src="{{ isset($content->image) && !empty($content->image) ? rtrim($s_image, '/') . '/' . $content->image : asset('custom/img/logo-placeholder-image-21.png') }}"
                                                            alt="image"
                                                            onerror="this.onerror=null; this.src='{{ asset('custom/img/logo-placeholder-image-21.png') }}';">
                                                    </div>
                                                    <h5 id="{{ 'title_' . $service_row_no . '_preview' }}">
                                                        {{ $content->title }}</h5>
                                                    <p id="{{ 'description_' . $service_row_no . '_preview' }}">
                                                        {{ $content->description }}
                                                    </p>
                                                    @if (!empty($content->purchase_link))
                                                        <a href="{{ url($content->purchase_link) }}"
                                                            class="read-more-btn"
                                                            id="{{ 'link_title_' . $service_row_no . '_preview' }}">
                                                            {{ $content->link_title }}
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="4"
                                                                height="6" viewBox="0 0 4 6" fill="none">
                                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                                    d="M0.65976 0.662719C0.446746 0.879677 0.446746 1.23143 0.65976 1.44839L2.18316 3L0.65976 4.55161C0.446747 4.76856 0.446747 5.12032 0.65976 5.33728C0.872773 5.55424 1.21814 5.55424 1.43115 5.33728L3.34024 3.39284C3.55325 3.17588 3.55325 2.82412 3.34024 2.60716L1.43115 0.662719C1.21814 0.445761 0.872773 0.445761 0.65976 0.662719Z"
                                                                    fill="white"></path>
                                                            </svg>
                                                        </a>
                                                    @endif
                                            
                                                </div>
                                            </div>
                                            @php
                                                $image_count++;
                                                $service_row_no++;
                                            @endphp
                                        @endforeach
                                    </div>
                                </div>
                            </section>
                        @endif
                     @endif

                        @if ($order_key == 'product' && !empty($products_content))
                                <section class="product-section padding-bottom" id="product-div">
                                    <div class="container">
                                    <div class="section-title text-center">
                                        <h2>{{ __('Product') }}</h2>
                                    </div>
                                    <div class="service-card-wrapper" id="inputrow_product_preview">
                                        @php $pr_image_count = 0; @endphp
                                        @foreach ($products_content as $k1 => $content)
                                            <div class=" service-card"
                                                id="product_{{ $product_row_no }}">
                                                <div class="service-card-inner">
                                                    <div class="service-icon">
                                                        <img id="{{ 'pr_image' . $pr_image_count . '_preview' }}"
                                                            src="{{ isset($content->image) && !empty($content->image) ? rtrim($pr_image, '/') . '/' . $content->image : asset('custom/img/logo-placeholder-image-21.png') }}" class="img-fluid"
                                                            alt="image"
                                                            onerror="this.onerror=null; this.src='{{ asset('custom/img/logo-placeholder-image-21.png') }}';"
                                                    </div>
                                                    <h5 id="{{ 'product_title_' . $product_row_no . '_preview' }}">
                                                        {{ $content->title }}</h5>
                                                    <p id="{{ 'product_description_' . $product_row_no . '_preview' }}">
                                                        {{ $content->description }}
                                                    </p>
                                                    <div class="product-currency" >
                                                        <span id="{{ 'product_currency_select' . $product_row_no . '_preview' }}">{{$content->currency}}</span>
                                                        <span id="{{ 'product_price_' . $product_row_no . '_preview' }}">{{$content->price }}</span>
                                                    </div>
                                                    
                                                    @if (!empty($content->purchase_link))
                                                        <a href="{{ url($content->purchase_link) }}"
                                                            id="{{ 'product_link_title_' . $product_row_no . '_preview' }}"
                                                            class="btn-secondary">{{ $content->link_title }}</a>
                                                    @endif
                                                </div>
                                            </div>
                                            @php
                                                $pr_image_count++;
                                                $product_row_no++;
                                            @endphp
                                        @endforeach
                                    </div>
                                    </div>
                                </section>
                            @endif
                        @if ($order_key == 'gallery' && !empty($gallery_contents))
                            <section class="gallery-section padding-top padding-bottom" id="gallery-div">
                                <div class="container">
                                    <div class="section-title text-center">
                                        <h2>{{ __('Gallery') }}</h2>
                                    </div>
                                    <div class="gallery-card-wrapper" id="inputrow_gallery_preview">
                                        @php $image_count = 0; @endphp
                                        @if (isset($is_pdf))
                                            <div class="row gallery-cards">
                                                @if (!is_null($gallery_contents) && !is_null($gallery))
                                                    @foreach ($gallery_contents as $key => $gallery_content)
                                                        <div class="col-md-6 col-12 p-0 gallery-card-pdf"
                                                            id="gallery_{{ $gallery_row_no }}">
                                                            <div class="gallery-card-inner-pdf">
                                                                <div class="gallery-icon-pdf">
                                                                    @if (isset($gallery_content->type))
                                                                        @if ($gallery_content->type == 'video')
                                                                            <a href="javascript:;" id=""
                                                                                tabindex="0" class="videopop">
                                                                                <video height="" controls>
                                                                                    <source class="videoresource"
                                                                                        src="{{ isset($gallery_content->value) && !empty($gallery_content->value) ? rtrim($gallery_path, '/') . '/' . $gallery_content->value : asset('custom/img/logo-placeholder-image-2.png') }}"
                                                                                        type="video/mp4">
                                                                                </video>
                                                                            </a>
                                                                        @elseif($gallery_content->type == 'image')
                                                                            <a href="javascript:;" id="imagepopup"
                                                                                tabindex="0" class="imagepopup">
                                                                                <img src="{{ isset($gallery_content->value) && !empty($gallery_content->value) ? rtrim($gallery_path, '/') . '/' . $gallery_content->value : asset('custom/img/logo-placeholder-image-2.png') }}"
                                                                                    alt="images"
                                                                                    class="imageresource"
                                                                                    loading="lazy"
                                                                                    decoding="async"
                                                                                    onerror="this.onerror=null; this.src='{{ asset('custom/img/logo-placeholder-image-2.png') }}';"
                                                                            </a>
                                                                        @endif
                                                                    @endif
                                                                </div>
                                                            </div>
                                                        </div>
                                                        @php
                                                            $image_count++;
                                                            $gallery_row_no++;
                                                        @endphp
                                                    @endforeach
                                                @endif
                                            </div>
                                        @else
                                            <div class="gallery-slider">
                                                @if (!is_null($gallery_contents) && !is_null($gallery))
                                                    @foreach ($gallery_contents as $key => $gallery_content)
                                                        <div class="gallery-card" id="gallery_{{ $gallery_row_no }}">
                                                            <div class="gallery-card-inner">
                                                                <div class="gallery-icon">
                                                                    @if (isset($gallery_content->type))
                                                                        @if ($gallery_content->type == 'video')
                                                                            <a href="javascript:;" id=""
                                                                                tabindex="0" class="videopop">
                                                                                <video loop controls="true">
                                                                                    <source class="videoresource"
                                                                                        src="{{ isset($gallery_content->value) && !empty($gallery_content->value) ? rtrim($gallery_path, '/') . '/' . $gallery_content->value : asset('custom/img/logo-placeholder-image-2.png') }}"
                                                                                        type="video/mp4">
                                                                                </video>
                                                                            </a>
                                                                        @elseif($gallery_content->type == 'image')
                                                                            <a href="javascript:;" id="imagepopup"
                                                                                tabindex="0" class="imagepopup">
                                                                                <img src="{{ isset($gallery_content->value) && !empty($gallery_content->value) ? rtrim($gallery_path, '/') . '/' . $gallery_content->value : asset('custom/img/logo-placeholder-image-2.png') }}"
                                                                                    alt="images"
                                                                                    class="imageresource"
                                                                                    loading="lazy"
                                                                                    decoding="async"
                                                                                    onerror="this.onerror=null; this.src='{{ asset('custom/img/logo-placeholder-image-2.png') }}';"
                                                                            </a>
                                                                        @elseif($gallery_content->type == 'custom_video_link')
                                                                            @if (str_contains($gallery_content->value, 'youtube') || str_contains($gallery_content->value, 'youtu.be'))
                                                                                @php
                                                                                    if (strpos($gallery_content->value, 'src') !== false) {
                                                                                        preg_match('/src="([^"]+)"/', $gallery_content->value, $match);
                                                                                        $url = $match[1];
                                                                                        $video_url = str_replace('https://www.youtube.com/embed/', '', $url);
                                                                                    } elseif (strpos($gallery_content->value, 'src') == false && strpos($gallery_content->value, 'embed') !== false) {
                                                                                        $video_url = str_replace('https://www.youtube.com/embed/', '', $gallery_content->value);
                                                                                    } else {
                                                                                        $video_url = str_replace('https://youtu.be/', '', str_replace('https://www.youtube.com/watch?v=', '', $gallery_content->value));
                                                                                        preg_match('/[\\?\\&]v=([^\\?\\&]+)/', $gallery_content->value, $matches);
                                                                                        if (count($matches) > 0) {
                                                                                            $videoId = $matches[1];
                                                                                            $video_url = strtok($videoId, '&');
                                                                                        }
                                                                                    }
                                                                                @endphp
                                                                                <a href="javascript:;" id=""
                                                                                    tabindex="0" class="videopop1">
                                                                                    <video loop controls="true" poster="{{ asset('custom/img/video_youtube.jpg') }}">
                                                                                        <source class="videoresource1"
                                                                                            src="{{ isset($gallery_content->value) && !empty($gallery_content->value) ? 'https://www.youtube.com/embed/' . $video_url : asset('custom/img/logo-placeholder-image-2.png') }}"
                                                                                            type="video/mp4">
                                                                                    </video>
                                                                                </a>
                                                                            @else
                                                                                <a href="javascript:;" id=""
                                                                                    tabindex="0" class="videopop1">
                                                                                    <video loop controls="true" poster="{{ asset('custom/img/video_youtube.jpg') }}">
                                                                                        <source class="videoresource1"
                                                                                            src="{{ isset($gallery_content->value) && !empty($gallery_content->value) ? $gallery_content->value : asset('custom/img/logo-placeholder-image-2.png') }}"
                                                                                            type="video/mp4">
                                                                                    </video>
                                                                                </a>
                                                                            @endif
                                                                        @elseif($gallery_content->type == 'custom_image_link')
                                                                            <a href="javascript:;" id=""
                                                                                target="" tabindex="0"
                                                                                class="imagepopup1">
                                                                                <img class="imageresource1"
                                                                                    src="{{ isset($gallery_content->value) && !empty($gallery_content->value) ? $gallery_content->value : asset('custom/img/logo-placeholder-image-2.png') }}"
                                                                                    alt="images" id="upload_image"
                                                                                    onerror="this.onerror=null; this.src='{{ asset('custom/img/logo-placeholder-image-2.png') }}';"
                                                                            </a>
                                                                        @endif
                                                                    @endif
                                                                </div>
                                                            </div>
                                                        </div>
                                                        @php
                                                            $image_count++;
                                                            $gallery_row_no++;
                                                        @endphp
                                                    @endforeach
                                                @endif
                                            </div>
                                        @endif
                                    </div>
                                </div>
                            </section>
                        @endif
                        @if ($order_key == 'more')
                            <section class="more-card-second-section padding-bottom">
                                <div class="container">
                                    @php
                                        if(isset($dslang)){
                                            $bsns_slug = $business->slug."?lang=".$dslang;
                                        }else{
                                            $bsns_slug = $business->slug;
                                        }
                                    @endphp
                                    <div class="more-card-btn">
                                        <a href="javascript:;" class="btn" tabindex="0"
                                            onclick="location.href = '{{ route('bussiness.save', $bsns_slug) }}'">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="19"
                                                viewBox="0 0 22 19" fill="none">
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M10.8676 5.41797L9.6954 3.46428C9.39795 2.96852 8.94858 2.68502 8.49937 2.62776C7.63403 2.51745 6.55518 2.41797 5.5 2.41797C4.76672 2.41797 4.0186 2.46607 3.33466 2.5334C2.70504 2.59538 2.24029 3.06309 2.19011 3.71721C2.08968 5.02657 2 6.90062 2 9.41797C2 11.1906 2.06456 12.7695 2.14656 14.0596C2.22311 15.2638 3.13628 16.1727 4.34979 16.2427C5.99648 16.3376 8.2132 16.418 11 16.418C13.7868 16.418 16.0035 16.3376 17.6502 16.2427C18.8637 16.1727 19.7769 15.2638 19.8534 14.0596C19.9354 12.7695 20 11.1906 20 9.41797C20 8.45184 19.944 7.53469 19.8699 6.74589C19.8087 6.09488 19.3231 5.60922 18.6721 5.54806C17.8833 5.47396 16.9661 5.41797 16 5.41797H10.8676ZM12 3.41797L11.4104 2.43529C10.8306 1.46891 9.87021 0.786322 8.75227 0.643814C7.83875 0.527364 6.66937 0.417969 5.5 0.417969C4.68392 0.417969 3.86784 0.471247 3.13873 0.543021C1.53169 0.701216 0.319474 1.95417 0.19597 3.56425C0.0913573 4.92805 0 6.85326 0 9.41797C0 11.2385 0.0662874 12.8602 0.150591 14.1865C0.291559 16.4042 2.01613 18.1114 4.23467 18.2394C5.91963 18.3365 8.17474 18.418 11 18.418C13.8253 18.418 16.0804 18.3365 17.7653 18.2394C19.9839 18.1114 21.7084 16.4042 21.8494 14.1865C21.9337 12.8602 22 11.2385 22 9.41797C22 8.37683 21.9398 7.39592 21.8611 6.55882C21.7101 4.95109 20.4669 3.70787 18.8591 3.55683C18.0221 3.47819 17.0411 3.41797 16 3.41797H12Z"
                                                    fill="white" />
                                            </svg>
                                            {{ __('Save Contact') }}
                                        </a>
                                        <a href="javascript:;" class="btn our-card" tabindex="0">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="22"
                                                viewBox="0 0 18 22" fill="none">
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M5.99858 9.03956C6.02798 9.59107 5.60474 10.062 5.05324 10.0914C4.30055 10.1315 3.7044 10.1806 3.23854 10.2297C2.61292 10.2957 2.23278 10.68 2.16959 11.2328C2.07886 12.0264 2 13.2275 2 14.9997C2 16.772 2.07886 17.973 2.16959 18.7666C2.23289 19.3204 2.61207 19.7036 3.23675 19.7695C4.33078 19.885 6.13925 19.9997 9 19.9997C11.8608 19.9997 13.6692 19.885 14.7632 19.7695C15.3879 19.7036 15.7671 19.3204 15.8304 18.7666C15.9211 17.973 16 16.7719 16 14.9997C16 13.2275 15.9211 12.0264 15.8304 11.2328C15.7672 10.68 15.3871 10.2957 14.7615 10.2297C14.2956 10.1806 13.6995 10.1315 12.9468 10.0914C12.3953 10.062 11.972 9.59107 12.0014 9.03956C12.0308 8.48806 12.5017 8.06482 13.0532 8.09422C13.8361 8.13595 14.4669 8.18757 14.9712 8.24075C16.4556 8.3973 17.6397 9.4504 17.8175 11.0056C17.9188 11.892 18 13.1712 18 14.9997C18 16.8282 17.9188 18.1074 17.8175 18.9938C17.6398 20.5481 16.4585 21.6017 14.9732 21.7585C13.7919 21.8831 11.9108 21.9997 9 21.9997C6.08922 21.9997 4.20806 21.8831 3.02684 21.7585C1.54151 21.6017 0.360208 20.5481 0.182529 18.9938C0.081204 18.1074 0 16.8282 0 14.9997C0 13.1712 0.0812039 11.892 0.182529 11.0056C0.360314 9.4504 1.54436 8.3973 3.02877 8.24075C3.53306 8.18757 4.16393 8.13595 4.94676 8.09422C5.49827 8.06482 5.96918 8.48806 5.99858 9.03956Z"
                                                    fill="white" />
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M6.20711 5.20711C5.81658 5.59763 5.18342 5.59763 4.79289 5.20711C4.40237 4.81658 4.40237 4.18342 4.79289 3.79289L8.29289 0.292893C8.68342 -0.0976311 9.31658 -0.0976311 9.70711 0.292893L13.2071 3.79289C13.5976 4.18342 13.5976 4.81658 13.2071 5.20711C12.8166 5.59763 12.1834 5.59763 11.7929 5.20711L10 3.41421V13C10 13.5523 9.55228 14 9 14C8.44772 14 8 13.5523 8 13L8 3.41421L6.20711 5.20711Z"
                                                    fill="white" />
                                            </svg>
                                            {{ __('Share Contact') }}
                                        </a>
                                        <a href="javascript:;" class="btn our-contact" tabindex="0">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                viewBox="0 0 20 20" fill="none">
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M4.82379 1.66449C5.83674 0.651544 7.512 0.770603 8.37152 1.91662L9.79825 3.81894C10.5011 4.75611 10.4079 6.06751 9.57958 6.89586L8.52769 7.94775C8.62963 8.2131 8.96522 8.79539 9.98717 9.81734C11.0091 10.8393 11.5914 11.1749 11.8567 11.2768L12.9086 10.2249C13.737 9.39657 15.0484 9.30336 15.9856 10.0062L17.8879 11.433C19.0339 12.2925 19.153 13.9678 18.14 14.9807C17.8107 15.31 17.755 15.3658 17.2054 15.9153C16.6453 16.4754 15.456 16.999 14.2519 17.0513C12.3677 17.1332 9.80829 16.2966 6.65811 13.1464C3.50793 9.99621 2.67127 7.43681 2.7532 5.55258C2.79877 4.50442 3.13201 3.35321 3.89355 2.6035C4.43874 2.04954 4.50964 1.97864 4.82379 1.66449ZM4.32105 5.62075C4.26426 6.92686 4.81471 9.08362 7.7678 12.0367C10.7209 14.9898 12.8776 15.5402 14.1838 15.4835C15.403 15.4304 16.0571 14.8413 16.0957 14.8056L17.0303 13.871C17.368 13.5334 17.3283 12.975 16.9463 12.6885L15.044 11.2617C14.7316 11.0274 14.2944 11.0585 14.0183 11.3346C13.6023 11.7506 13.3183 12.0388 12.7624 12.5926C11.6077 13.743 9.63106 11.6806 8.87748 10.927C8.18495 10.2345 6.07446 8.1951 7.21078 7.04531C7.21302 7.04305 7.51909 6.73699 8.4699 5.78618C8.74601 5.51006 8.77708 5.07293 8.54279 4.76054L7.11605 2.85822C6.82955 2.47621 6.27112 2.43653 5.93348 2.77418C5.62271 3.08494 5.271 3.43665 4.99979 3.70973C4.44161 4.27178 4.35092 4.93369 4.32105 5.62075Z"
                                                    fill="white" />
                                            </svg>
                                            {{ __('Make Connection') }}
                                        </a>
                                    </div>
                                </div>
                            </section>
                        @endif
                        @if ($order_key == 'testimonials' && !empty($testimonials_content))
                            <section class="testimonials-section padding-top" id="testimonials-div">
                                <div class="container">
                                    <div class="section-title text-center">
                                        <h2>{{ __('Testimonials') }}</h2>
                                    </div>
                                    @if (isset($is_pdf))
                                        <div class="row testimonial-pdf-row" id="inputrow_testimonials_preview">
                                            @php
                                                $t_image_count = 0;
                                                $rating = 0;
                                            @endphp
                                            @foreach ($testimonials_content as $k2 => $testi_content)
                                                <div class=" col-md-6 col-12 testimonial-itm-pdf"
                                                    id="testimonials_{{ $testimonials_row_no }}">
                                                    <div class="testimonial-itm-inner-pdf">
                                                        <div class="testi-client-img-pdf">
                                                            <img id="{{ 't_image' . $t_image_count . '_preview' }}"
                                                                src="{{ isset($testi_content->image) && !empty($testi_content->image) ? rtrim($image, '/') . '/' . $testi_content->image : asset('custom/img/placeholder-image12.jpg') }}"
                                                                alt="image"
                                                                onerror="this.onerror=null; this.src='{{ asset('custom/img/placeholder-image12.jpg') }}';"
                                                        </div>
                                                        <div class="testimonial-pdf-bdy">
                                                            <h5 class="rating-number">{{ $testi_content->rating }}/5
                                                            </h5>

                                                            <div class="rating-star">
                                                                @php
                                                                    if (!empty($testi_content->rating)) {
                                                                        $rating = (int) $testi_content->rating;
                                                                        $overallrating = $rating;
                                                                    } else {
                                                                        $overallrating = 0;
                                                                    }
                                                                @endphp
                                                                <span id="{{ 'stars' . $testimonials_row_no }}_star"
                                                                    class="star-section d-flex align-items-center justify-content-center">
                                                                    @for ($i = 1; $i <= 5; $i++)
                                                                        @if ($overallrating < $i)
                                                                            @if (is_float($overallrating) && round($overallrating) == $i)
                                                                                <i
                                                                                    class="star-color fas fa-star-half-alt"></i>
                                                                            @else
                                                                                <i class="fa fa-star"></i>
                                                                            @endif
                                                                        @else
                                                                            <i class="star-color fas fa-star"></i>
                                                                        @endif
                                                                    @endfor
                                                                </span>
                                                            </div>
                                                            <p
                                                                id="{{ 'testimonial_description_' . $testimonials_row_no . '_preview' }}">
                                                                {{ $testi_content->description }}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                @php
                                                    $t_image_count++;
                                                    $testimonials_row_no++;
                                                @endphp
                                            @endforeach
                                        </div>
                                    @else
                                        <div class="testimonial-slider" id="inputrow_testimonials_preview">
                                            @php
                                                $t_image_count = 0;
                                                $rating = 0;
                                            @endphp
                                            @foreach ($testimonials_content as $k2 => $testi_content)
                                                <div class="testimonial-itm"
                                                    id="testimonials_{{ $testimonials_row_no }}">
                                                    <div class="testimonial-itm-inner">
                                                        <div class="testi-client-img">
                                                            <img id="{{ 't_image' . $t_image_count . '_preview' }}"
                                                                src="{{ isset($testi_content->image) && !empty($testi_content->image) ? rtrim($image, '/') . '/' . $testi_content->image : asset('custom/img/placeholder-image12.jpg') }}"
                                                                class="img-fluid" alt="image"
                                                                onerror="this.onerror=null; this.src='{{ asset('custom/img/placeholder-image12.jpg') }}';"
                                                        </div>
                                                        <h5 class="rating-number"><span
                                                                class="{{ 'stars' . $testimonials_row_no }}">{{ $testi_content->rating }}</span>/5
                                                        </h5>
                                                        @php
                                                            if (!empty($testi_content->rating)) {
                                                                $rating = (int) $testi_content->rating;
                                                                $overallrating = $rating;
                                                            } else {
                                                                $overallrating = 0;
                                                            }
                                                        @endphp
                                                        <div id="{{ 'stars' . $testimonials_row_no }}_star"
                                                            class="rating-star star-section">
                                                            @for ($i = 1; $i <= 5; $i++)
                                                                @if ($overallrating < $i)
                                                                    @if (is_float($overallrating) && round($overallrating) == $i)
                                                                        <i class="star-color fas fa-star-half-alt"></i>
                                                                    @else
                                                                        <i class=" fa fa-star"></i>
                                                                    @endif
                                                                @else
                                                                    <i class="star-color fas fa-star"></i>
                                                                @endif
                                                            @endfor
                                                        </div>
                                                        <p
                                                            id="{{ 'testimonial_description_' . $testimonials_row_no . '_preview' }}">
                                                            {{ $testi_content->description }}
                                                        </p>
                                                    </div>
                                                </div>
                                                @php
                                                    $t_image_count++;
                                                    $testimonials_row_no++;
                                                @endphp
                                            @endforeach
                                        </div>
                                    @endif
                                </div>
                            </section>
                        @endif
                        @if ($order_key == 'contact_info')
                            <div class="container" id="contact-div">
                                <div class="client-contact" id="inputrow_contact_preview">
                                    @if (!is_null($contactinfo_content) && !is_null($contactinfo))
                                        @foreach ($contactinfo_content as $key => $val)
                                            @foreach ($val as $key1 => $val1)
                                                @php
                                                    // Ensure $val1 is a string
                                                    $val1_str = is_object($val1) ? json_encode($val1) : (string)$val1;
                                                @endphp
                                                @if ($key1 == 'Phone')
                                                    @php $href = 'tel:'.$val1_str; @endphp
                                                @elseif($key1 == 'Email')
                                                    @php $href = 'mailto:'.$val1_str; @endphp
                                                @elseif($key1 == 'Address')
                                                    @php $href = '#social-div'; @endphp
                                                @elseif($key1 == 'Telephone')
                                                    @php $href = 'tel:'.$val1_str; @endphp
                                                @elseif($key1 == 'Fax')
                                                    @php $href = 'fax:'.$val1_str; @endphp
                                                @elseif($key1 == 'Whatsapp')
                                                    @php $href = 'https://wa.me/'.$val1_str; @endphp
                                                @elseif($key1 == 'Web_url')
                                                    @if (!preg_match("~^(?:f|ht)tps?://~i", $val1_str))
                                                        @php $href = "http://" . $val1_str; @endphp
                                                    @else
                                                        @php $href = $val1_str; @endphp
                                                    @endif
                                                @else
                                                    @php $href = $val1_str; @endphp
                                                @endif
                                                @if ($key1 != 'id')
                                                    @php
                                                        // Map contact types to modern Font Awesome icons
                                                        // Using solid icons for better visibility and consistency, RTL-compatible
                                                        $icon_class = '';
                                                        if ($key1 == 'Email') {
                                                            $icon_class = 'fas fa-envelope'; // Modern solid envelope icon
                                                        } elseif ($key1 == 'Phone') {
                                                            $icon_class = 'fas fa-mobile-alt'; // Mobile phone icon - works in both FA 5 and 6
                                                        } elseif ($key1 == 'Telephone') {
                                                            $icon_class = 'fas fa-phone'; // Classic telephone icon - universally compatible
                                                        } elseif ($key1 == 'Web_url') {
                                                            $icon_class = 'fas fa-globe'; // Globe icon - universally compatible
                                                        } elseif ($key1 == 'Address' || $key1 == 'Location') {
                                                            $icon_class = 'fas fa-map-marker-alt'; // Location pin icon - universally compatible
                                                        } elseif ($key1 == 'Fax') {
                                                            $icon_class = 'fas fa-fax'; // Fax icon
                                                        } elseif ($key1 == 'Whatsapp') {
                                                            $icon_class = 'fab fa-whatsapp'; // WhatsApp brand icon
                                                        } else {
                                                            $icon_class = 'fas fa-circle'; // Default solid circle
                                                        }
                                                    @endphp
            
                                                    <div class="calllink contactlink contact-card contact_{{ $loop->parent->index + 1 }}"
                                                        id="contact_{{ $loop->parent->index + 1 }}">
                                                        <a href="{{ $href }}" class="theme-text">
                                                            <i class="{{ $icon_class }} contact-icon"></i>
                                                            <div class="contact-text">
                                                                @if ($key1 == 'LinkedIn')
                                                                    @php $val1 = "www.linkedin.com"; @endphp
                                                                @endif
                                                                 @if ($key1 == 'Location')
                                                                    @php $val1 = "Find us on google maps"; @endphp
                                                                @endif
                                                                <span class="contact-value {{ ($key1 == 'Phone' || $key1 == 'Telephone') ? 'ltr-number' : '' }} {{ $key1 . '_' . $no }}_preview"
                                                                    id="{{ $key1 . '_' . $no }}_preview">{{ is_object($val1) ? json_encode($val1) : (string)$val1 }}</span>
                                                                <div class="contact-label">
                                                                @if($key1 == 'Phone')
                                                                    {{ __('Mobile') }}
                                                                @elseif($key1 == 'Web_url')
                                                                    {{ __('Website') }}
                                                                @else
                                                                    {{ __($key1) }}
                                                                @endif
                                                                </div>
                                                            </div>
                                                        </a>
                                                    </div>
                                                @endif
                                            @endforeach
                                        @endforeach
                                    @endif
                                </div>
                            </div>
                        @endif
                        @if ($order_key == 'social')
                            <section class="social-icons-second-section " id="social-div">
                                <div class="container">
                                    <div class="section-title text-center">
                                        <h2>{{ __('Social') }}</h2>
                                    </div>
                                    <ul class="social-icon-wrapper" id="inputrow_socials_preview">
                                        @if (!is_null($social_content) && !is_null($sociallinks))
                                            @foreach ($social_content as $social_key => $social_val)
                                                @foreach ($social_val as $social_key1 => $social_val1)
                                                    @if ($social_key1 != 'id')
                                                        <li class="socials_{{ $loop->parent->index + 1 }}"
                                                            id="socials_{{ $loop->parent->index + 1 }}">
                                                            @if ($social_key1 == 'Whatsapp')
                                                                @if ((new \Jenssegers\Agent\Agent())->isDesktop())
                                                                    @php
                                                                        $social_links = url('https://web.whatsapp.com/send?phone=' . $social_val1);
                                                                    @endphp
                                                                @else
                                                                    @php
                                                                        $social_links = url('https://wa.me/' . $social_val1);
                                                                    @endphp
                                                                @endif
                                                            @else
                                                                @php
                                                                    $social_links = url($social_val1);
                                                                @endphp
                                                            @endif
                                                            <a href="{{ $social_links }}"
                                                                class="social_link_{{ $loop->parent->index + 1 }}_href_preview"
                                                                id="social_link_{{ $loop->parent->index + 1 }}_href_preview"
                                                                target="_blank">
                                                                @php
                                                                    $iconFile = strtolower($social_key1);
                                                                    if ($social_key1 == 'Web_url') {
                                                                        $iconFile = 'web_url';
                                                                    }
                                                                @endphp
                                                                <img src="{{ asset('custom/theme19/icon/' . $color . '/social/' . $iconFile . '.svg') }}" alt="{{ $social_key1 }}" class="img-fluid" style="height: 30px">
                                                            </a>
                                                        </li>
                                                    @endif
                                                @endforeach
                                            @endforeach
                                        @endif
                                    </ul>
                                </div>
                            </section>
                        @endif
                        @if ($order_key == 'custom_html')
                            <div id="{{ $stringid . '_chtml' }}_preview" class="custom_html_text">
                                {!! stripslashes($custom_html) !!}
                            </div>
                            
                             <style>
                                .custom_html_text {
                                    padding: 0px 12px !important;
                                    margin: 20px 0px !important;
                                    color: black !important;
                                }
                                .custom_html_text * {
                                    color: black !important;
                                }
                        </style>
                        @endif
                      
                      
                      

                           

  @if ($order_key == 'map_iframe' )
                                    <section id="map_iframe_preview" class="card-footer print map_iframe" style="background:white !important; padding: 1px 15px;@if(!$is_map_iframe_enabled) display: none; @endif">
                                     
                                        <style>
                                            #map_iframe_preview_ {
                                                width: 100%;
                                                height: 200px; 
                                            }
                                            
                                        </style>
                                        <h2 class="text-center mb-3 " style="margin: 10px 0px ">{{ __('Business Address') }}</h2>
                                         <div class="greetings-desk">
                                            <div class="text-white"
                                                id="map_iframe_preview_">
                                                   
                                            </div>
                                            
                                            <input name="map-iframe" class="hide_afb" id="map-iframe" value="{{ stripslashes($map_iframe ?? '') }}" hidden type="hidden">
                                        </div>

                                    </section>
                            @endif


                        @php
                            $j = $j + 1;
                        @endphp
                    @endif
                @endforeach
                @if ($plan->enable_branding == 'on')
                    @if ($is_branding_enabled)
                        <div id="is_branding_enabled" class="is_branding_enable copyright mt-3 pb-2">
                            <p id="{{ $stringid . '_branding' }}_preview" class="branding_text">
                                {{ $business->branding_text }}
                            </p>
                        </div>
                    @endif
                @endif
            </div>
            <!--appointment popup start here-->
            <div class="appointment-popup" style="display: none;">
                <div class="container">
                    <form class="appointment-form-wrapper">
                        <div class="section-title">
                            <h5>{{ __('Make Appointment') }}</h5>
                            <div class="close-search">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                    viewBox="0 0 18 18" fill="none">
                                    <path
                                        d="M14.6 17.4L0.600001 3.4C-0.2 2.6 -0.2 1.4 0.600001 0.600001C1.4 -0.2 2.6 -0.2 3.4 0.600001L17.4 14.6C18.2 15.4 18.2 16.6 17.4 17.4C16.6 18.2 15.4 18.2 14.6 17.4V17.4Z"
                                        fill="#000" />
                                    <path
                                        d="M0.600001 14.6L14.6 0.600001C15.4 -0.2 16.6 -0.2 17.4 0.600001C18.2 1.4 18.2 2.6 17.4 3.4L3.4 17.4C2.6 18.2 1.4 18.2 0.600001 17.4C-0.2 16.6 -0.2 15.4 0.600001 14.6V14.6Z"
                                        fill="#000" />
                                </svg>
                            </div>
                        </div>
                        <div class="row appo-form-details">
                            <div class="col-12">
                                <div class="form-group">
                                    <label>{{ __('Name:') }} </label>
                                    <input type="text" class="form-control app_name"
                                        placeholder="{{ __('Enter your name') }}">
                                    <div class="">
                                        <span class="text-danger  h5 span-error-name"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-group">
                                    <label>{{ __('Email:') }} </label>
                                    <input type="email" class="form-control app_email"
                                        placeholder="{{ __('Enter your email') }}">
                                    <div class="">
                                        <span class="text-danger  h5 span-error-email"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-group">
                                    <label>{{ __('Phone:') }} </label>
                                    <input type="number" class="form-control app_phone"
                                        placeholder="{{ __('Enter your phone no.') }}">
                                    <div class="">
                                        <span class="text-danger  h5 span-error-phone"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-btn-group">
                            <button type="button" name="CLOSE" class="close-btn btn">
                                {{ __('Close') }}
                            </button>
                            <button type="button" name="SUBMIT" class="btn btn-secondary" id="makeappointment">
                                {{ __('Make Appointment') }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <!--appointment popup end here-->
            <!--card popup start here-->
            <div class="card-popup" style="display: none;">
                <div class="container">
                    <div class="share-card-wrapper">
                        <div class="section-title">
                            <div class="close-search">
                                <svg xmlns="http://www.w3.org/2000/svg" width="7" height="9"
                                    viewBox="0 0 7 9" fill="none">
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M5.84542 0.409757C6.21819 0.789434 6.21819 1.40501 5.84542 1.78469L3.17948 4.5L5.84542 7.21531C6.21819 7.59499 6.21819 8.21057 5.84542 8.59024C5.47265 8.96992 4.86826 8.96992 4.49549 8.59024L1.15458 5.18746C0.781807 4.80779 0.781807 4.19221 1.15458 3.81254L4.49549 0.409757C4.86826 0.0300809 5.47265 0.0300809 5.84542 0.409757Z"
                                        fill="#12131A" />
                                </svg>
                            </div>
                            <div class="section-title-center">
                                <h5>{{ __('Share This Card') }}</h5>
                            </div>
                            <button type="button" name="LOGOUT" class="logout-btn">

                            </button>
                        </div>
                        <div class="qr-scaner-wrapper">
                            <div class="qr-image shareqrcode" id="qr-container-debug" data-debug="qr-container">
                                <!-- Loading indicator -->
                                <div id="qr-loading-indicator" style="display:none;text-align:center;padding:20px;color:#666;">
                                    <p>Generating QR Code...</p>
                                </div>
                            </div>
                            <div class="qr-code-text">
                                <p> {{ __('Point your camera at the QR code, or visit') }} <span
                                        class="qr-link text-center mr-2 text-wrap"></span><br>{{ __('
                                                                                                                                                                                                                                                                                                                        Or check my social channels') }}
                                </p>
                            </div>
                            <ul class="card-social-icons">
                                <li>
                                    @php
                                        $twitter_url = 'https://twitter.com/share?url=' . urlencode($url_link) . '&text=';
                                    @endphp
                                    <a href="{{ $twitter_url }}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            viewBox="0 0 20 20" fill="none">
                                            <path
                                                d="M14.4827 8.25C14.7327 12 11.9827 15 8.48276 15C7.27681 15 6.07085 14.8384 5.12473 14.3853C4.90804 14.2815 4.99274 13.9925 5.23247 13.9766C6.39751 13.8993 7.36161 13.6212 7.98276 13C9.48285 11.5 9.7328 11 10.1151 9.01198C10.0294 8.77402 9.98275 8.51746 9.98275 8.25C9.98275 7.00736 10.9901 6 12.2327 6C12.9918 6 13.6631 6.37591 14.0706 6.95173L14.9292 6.82908C15.1431 6.79852 15.2925 7.03543 15.1726 7.21523L14.4827 8.25Z"
                                                fill="white"></path>
                                            <path
                                                d="M7.98278 13C5.27458 12.0972 4.80743 8.7497 5.29392 7.00354C5.35104 6.7985 5.61761 6.79744 5.72505 6.98117C6.55579 8.4018 8.13538 9.19496 10.1151 9.01193C13.2328 9.01193 12.4828 14.5 7.98278 13Z"
                                                fill="white"></path>
                                            <rect x="0.75" y="0.75" width="18.5" height="18.5"
                                                rx="3.25" stroke="white" stroke-width="1.5"></rect>
                                        </svg>
                                    </a>
                                </li>
                                <li>
                                    @php
                                        $whatsapp_link = 'https://wa.me/?text=' . urlencode($url_link);
                                    @endphp
                                    <a href="{{ $whatsapp_link }}">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M10 0C4.5 0 0 4.5 0 10C0 11.8 0.500781 13.5 1.30078 15L0 20L5.19922 18.8008C6.69922 19.6008 8.3 20 10 20C15.5 20 20 15.5 20 10C20 7.3 18.9996 4.80039 17.0996 2.90039C15.1996 1.00039 12.7 0 10 0ZM10 2C12.1 2 14.0992 2.80078 15.6992 4.30078C17.1992 5.90078 18 7.9 18 10C18 14.4 14.4 18 10 18C8.7 18 7.29922 17.7 6.19922 17L5.5 16.5996L4.80078 16.8008L2.80078 17.3008L3.30078 15.5L3.5 14.6992L3.09961 14C2.39961 12.8 2 11.4 2 10C2 5.6 5.6 2 10 2ZM6.5 5.40039C6.3 5.40039 6.00078 5.39922 5.80078 5.69922C5.50078 5.99922 4.90039 6.60078 4.90039 7.80078C4.90039 9.00078 5.80039 10.2004 5.90039 10.4004C6.10039 10.6004 7.69922 13.1992 10.1992 14.1992C12.2992 14.9992 12.6992 14.8008 13.1992 14.8008C13.6992 14.7008 14.7004 14.1996 14.9004 13.5996C15.1004 12.9996 15.0992 12.4992 15.1992 12.1992C15.0992 12.0992 14.9992 12.0004 14.6992 11.9004C14.4992 11.8004 13.3 11.1996 13 11.0996C12.7 10.9996 12.6004 10.8992 12.4004 11.1992C12.2004 11.4992 11.6996 11.9992 11.5996 12.1992C11.4996 12.3992 11.3996 12.4008 11.0996 12.3008C10.8996 12.2008 10.0996 11.9996 9.09961 11.0996C8.29961 10.4996 7.79922 9.70039 7.69922 9.40039C7.49922 9.20039 7.70078 9.00039 7.80078 8.90039L8.19922 8.5C8.29922 8.4 8.30039 8.19961 8.40039 8.09961C8.50039 7.99961 8.50039 7.89922 8.40039 7.69922C8.30039 7.49922 7.79961 6.30078 7.59961 5.80078C7.39961 5.40078 7.2 5.40039 7 5.40039H6.5Z"
                                                fill="white" />
                                        </svg>

                                    </a>
                                </li>
                                <li>
                                    @php
                                        $facebook_url = 'https://www.facebook.com/sharer.php?u=' . urlencode($url_link);
                                    @endphp
                                    <a href="{{ $facebook_url }}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            viewBox="0 0 20 20" fill="none">
                                            <path
                                                d="M13.3333 19.25H11H3C2.61666 19.25 2.04526 18.9887 1.53351 18.4845C1.02334 17.9819 0.75 17.4126 0.75 17V3C0.75 2.58739 1.02334 2.01811 1.53351 1.51546C2.04526 1.01127 2.61666 0.75 3 0.75H17C17.3833 0.75 17.9547 1.01127 18.4665 1.51546C18.9767 2.01811 19.25 2.58739 19.25 3V17C19.25 17.4126 18.9767 17.9819 18.4665 18.4845C17.9547 18.9887 17.3833 19.25 17 19.25H13.3333Z"
                                                stroke="white" stroke-width="1.5"></path>
                                            <path
                                                d="M12 8.21429C12 7.62255 12.4477 7.14286 13 7.14286H14C14.5523 7.14286 15 6.66317 15 6.07143C15 5.47969 14.5523 5 14 5H13C11.3431 5 10 6.43908 10 8.21429V10.3571H9C8.44771 10.3571 8 10.8368 8 11.4286C8 12.0203 8.44771 12.5 9 12.5H10V18.9286C10 19.5203 10.4477 20 11 20C11.5523 20 12 19.5203 12 18.9286V12.5H14C14.5523 12.5 15 12.0203 15 11.4286C15 10.8368 14.5523 10.3571 14 10.3571H12V8.21429Z"
                                                fill="white"></path>
                                        </svg>
                                    </a>
                                </li>
                                <li>
                                    @php
                                        $linkedin_url = 'https://www.linkedin.com/shareArticle?url=' . urlencode($url_link) . '&title=';
                                    @endphp
                                    <a href="{{ $linkedin_url }}">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path  d="M0 3C0 1.34315 1.34315 0 3 0H17C18.6569 0 20 1.34315 20 3V17C20 18.6569 18.6569 20 17 20H3C1.34315 20 0 18.6569 0 17V3Z" stroke="white" stroke-width="1.5"/>
                                            <path d="M5 6C5.55228 6 6 5.55228 6 5C6 4.44772 5.55228 4 5 4C4.44772 4 4 4.44772 4 5C4 5.55228 4.44772 6 5 6Z" fill="white"/>
                                            <path d="M5 8C4.44772 8 4 8.44772 4 9V15C4 15.5523 4.44772 16 5 16C5.55228 16 6 15.5523 6 15V9C6 8.44772 5.55228 8 5 8Z" fill="white"/>
                                            <path d="M12 10C10.8954 10 10 10.8954 10 12V15C10 15.5523 9.55229 16 9 16C8.44771 16 8 15.5523 8 15V9C8 8.44772 8.44772 8 9 8C9.40537 8 9.7544 8.2412 9.91141 8.58791C10.5193 8.215 11.2346 8 12 8C14.2091 8 16 9.79086 16 12V15C16 15.5523 15.5523 16 15 16C14.4477 16 14 15.5523 14 15V12C14 10.8954 13.1046 10 12 10Z" fill="white"/>
                                            </svg>
                                    </a>
                                </li>
                            </ul>

                        </div>

                        </div>

                    </div>
                </div>
            </div>
            <!--contact popup start here-->
            <div class="contact-popup" id="mycontactModal" style="display: none;">
                <div class="container">
                    <div class="modal-dialog modal-dialog-centered modal-responsive">
                        <div class="modal-content contact-modal-dark">
                            <form class="contact-form-wrapper">
                                <div class="modal-header border-0">
                                    <h5 class="modal-title text-white">{{ __('Make Contact') }}</h5>
                                    <button type="button" class="btn-close btn-close-white" onclick="$('.contact-popup').removeClass('active').attr('style', 'display: none;'); $('body').removeClass('no-scroll'); $('html').removeClass('modal-open');"></button>
                                </div>

                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label class="form-label text-light">{{ __('Name') }}</label>
                                        <input type="text" name="name" class="form-control contact-input contact_name" placeholder="{{ __('Enter your name') }}">
                                        <div class="mt-1">
                                            <span class="text-danger span-error-contactname"></span>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label text-light">{{ __('Email') }}</label>
                                        <input type="email" name="email" class="form-control contact-input contact_email" placeholder="{{ __('Enter your email') }}">
                                        <div class="mt-1">
                                            <span class="text-danger span-error-contactemail"></span>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label text-light">{{ __('Phone') }}</label>
                                        <input type="text" name="phone" class="form-control contact-input contact_phone" placeholder="{{ __('Enter your phone') }}">
                                        <div class="mt-1">
                                            <span class="text-danger span-error-contactphone"></span>
                                        </div>
                                    </div>

                                    <input type="hidden" name="business_id" value="{{ $business->id }}">

                                    <div class="mb-3">
                                        <label class="form-label text-light">{{ __('Message') }}</label>
                                        <textarea name="message" class="form-control contact-input contact_message emojiarea" rows="4" placeholder="{{ __('Enter your message...') }}"></textarea>
                                        <div class="mt-1">
                                            <span class="text-danger span-error-contactmessage"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer border-0">
                                    <button type="button" class="btn btn-secondary contact-btn" onclick="$('.contact-popup').removeClass('active').attr('style', 'display: none;'); $('body').removeClass('no-scroll'); $('html').removeClass('modal-open');">{{ __('Close') }}</button>
                                    <button type="button" class="btn btn-primary contact-btn-primary" id="makecontact">{{ __('Make Contact') }}</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!--contact popup end here-->
            <!--card popup end here-->
            <div class="contact-popup-2" id="passwordmodel" role="dialog" data-backdrop="static"
                data-keyboard="false" style="display: none;">
                <div class="container">
                    <form class="appointment-form-wrapper contact-form-wrapper">
                        <div class="section-title">
                            <h5>{{ __('Enter Password') }}</h5>
                        </div>
                        <div class="row appo-form-details">
                            <div class="col-12">
                                <div class="form-group">
                                    <label>{{ __('Password') }}:</label>
                                    <input type="password" name="Password" placeholder="{{ __('Enter password') }}"
                                        class="form-control password_val" placeholder="Password">
                                    <div class="">
                                        <span class="text-danger  h5 span-error-password"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-btn-group">
                            <button type="button"
                                class="btn form-btn--submit password-submit">{{ __('Submit') }}</button>


                        </div>
                    </form>
                </div>
            </div>

            {{-- Gallery Models --}}
            <div class="contact-popup-2" id="gallerymodel" role="dialog" data-backdrop="static"
                data-keyboard="false" style="display: none;">
                <div class="container">
                    <form class="appointment-form-wrapper contact-form-wrapper">
                        <div class="section-title">
                            <h5>{{ __('') }}</h5>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="form-group section-title">
                                    <label>{{ __('Image preview') }}:</label>
                                    <img src="" class="imagepreview" style="width: 500px; height: 300px;">
                                </div>
                            </div>
                        </div>
                        <div class="form-btn-group">
                            <button type="button" class="btn btn-default close-btn close-model"
                                data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="contact-popup-2" id="videomodel" role="dialog" data-backdrop="static"
                data-keyboard="false" style="display: none;">
                <div class="container">
                    <form class="appointment-form-wrapper contact-form-wrapper">
                        <div class="section-title">
                            <h5>{{ __('') }}</h5>
                        </div>
                        <div class="row ">
                            <div class="col-12">
                                <div class="form-group section-title">
                                    <label>{{ __('Video preview') }}:</label>
                                    <iframe width="100%" height="360" class="videopreview" src=""
                                        frameborder="0" allowfullscreen></iframe>
                                </div>
                            </div>
                        </div>
                        <div class="form-btn-group">
                            <button type="button" class="btn btn-default close-btn close-model1"
                                data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="overlay"></div>
            @if(isset($qr_detail->image) && !empty($qr_detail->image))
                <img src="{{ $qr_path . '/' . $qr_detail->image }}" id="image-buffers" style="display: none" onerror="this.onerror=null; this.src=''; this.style.display='none';">
            @else
                <img src="" id="image-buffers" style="display: none">
            @endif
        </div>
    </div>
    <div id="previewImage"> </div>
    <a id="download" href="#" class="font-lg download mr-3 text-white">
        <i class="fas fa-download"></i>
    </a>
    <!---wrapper end here-->
    <!-- Modal -->
    <!--scripts start here-->

    <script src="{{ asset('custom/theme19/js/jquery.min.js') }}"></script>
    <script src="{{ asset('custom/theme19/js/slick.min.js') }}" defer></script>
    @if ($SITE_RTL == 'on')
        <script src="{{ asset('custom/theme19/js/rtl-custom.js') }}" defer="defer"></script>
    @else
        <script src="{{ asset('custom/theme19/js/custom.js') }}" defer="defer"></script>
    @endif

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.5.3/picker.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pickadate.js/3.5.3/picker.date.js"></script>
    {{-- Always load QR code libraries for reliability --}}
    <script type="text/javascript" src="https://jeromeetienne.github.io/jquery-qrcode/src/qrcode.js"></script>
    <script src="{{ asset('custom/js/jquery.qrcode.js') }}"></script>
    {{-- Load QRCode.js for client-side fallback --}}
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js" onerror="console.warn('QRCode.js CDN failed, will use jQuery QRCode')"></script>
    @if (isset($plan->enable_qr_code) && $plan->enable_qr_code == 'on')
        {{-- Load advanced QR code library if available --}}
        <script src="{{ asset('custom/js/jquery.qrcode.min.js') }}" onerror="console.warn('Advanced QR library failed to load, using basic version')"></script>
    @endif
    <script src="{{ asset('custom/libs/bootstrap-notify/bootstrap-notify.min.js') }}" defer></script>
    <script src="{{ asset('custom/js/socialSharing.js') }}" defer></script>
    <script src="{{ asset('custom/js/socialSharing.min.js') }}" defer></script>
    
    
    
    
           <script>
       var preview = @if(isset($map_iframe) && $map_iframe!="") true @else false @endif ;
       var isMapEnabled = @if($is_map_iframe_enabled && isset($map_iframe) && $map_iframe!="") true @else false @endif;
        function initMap() {
            // Check if map is enabled and container exists
            if (!isMapEnabled) {
                console.log('Google Maps is disabled or no address provided');
                return;
            }
            
            const mapContainer = document.getElementById('map_iframe_preview_');
            if (!mapContainer) {
                console.error('Map container not found');
                return;
            }
            
            console.log("Initializing Google Maps", mapContainer);
            const input = document.getElementById('map-iframe');
            if (!input) {
                console.error('Map input field not found');
                return;
            }
            
            const autocomplete = new google.maps.places.Autocomplete(input);
            var geocoder = new google.maps.Geocoder();

            // Optional: Set the country to restrict suggestions
            // autocomplete.setComponentRestrictions({'country': 'us'});

            // Optional: Set the types of predictions to be returned
            // autocomplete.setTypes(['geocode']);

            // Optional: Add event listener to handle place selection
            autocomplete.addListener('place_changed', function() {
               
                const place = autocomplete.getPlace();
                 console.log("chaneed", place)
                if (!place.geometry) {
                    console.log("Place details not available for input: ", input.value);
                    return;
                }

                // Access place details using place object
                console.log("Selected Place:", place.name);
                console.log("Address:", place.formatted_address);
                console.log("Latitude:", place.geometry.location.lat());
                console.log("Longitude:", place.geometry.location.lng());

                // Display the map preview
                displayMapPreview(place);
            });
            
         
            
            if(input && input.value && input.value!=""){ 
                console.log("Loading map for address:", input.value);
                var address = input.value;
                var autocompleteService = new google.maps.places.AutocompleteService();
                
                 autocompleteService.getPlacePredictions({ input: address }, function(predictions, status) {
                    if (status == google.maps.places.PlacesServiceStatus.OK && predictions) {
    
                        var firstPrediction = predictions[0];
                        
                        var hideInput = document.querySelector(".hide_afb");
                        if (hideInput) {
                            hideInput.setAttribute("hidden", "hidden");
                        } 
 
                    
 
                        geocoder.geocode({ 'placeId': firstPrediction.place_id }, function(results, status) {
                            if (status == google.maps.GeocoderStatus.OK && results && results.length > 0) {
                                var location = results[0];
                                displayMapPreview(location) 
                                
                            } else {
                                console.error('Geocode was not successful for the following reason: ' + status);
                            }
                        });
                        
                    } else {
                        console.error('No predictions found for address:', address);
                    }
                });
            
            }
        }

         
       
       function displayMapPreview(place) {
            const mapContainer = document.getElementById('map_iframe_preview_');
            if (!mapContainer) {
                console.error('Map container not found');
                return;
            }
            
            if (!place || !place.geometry || !place.geometry.location) {
                console.error('Invalid place data provided');
                return;
            }
            
            try {
                const mapPreview = new google.maps.Map(mapContainer, {
                    center: place.geometry.location,
                    zoom: 15,
                    disableDefaultUI: true // Disable default map type controls
                });
            
            let place_name = {!! json_encode(substr(stripslashes($map_iframe ?? ''), 0, strpos(stripslashes($map_iframe ?? ''), ',') ?: strlen(stripslashes($map_iframe ?? '')))) !!};
            //   if(place.plus_code.compound_code!=""){
            //       place_name = place.plus_code.compound_code
            //   }
            

                const infowindow = new google.maps.InfoWindow({
                    content: '<div style="padding: 8px 12px;color:black;margin-bottom:5px" ><strong style="color: #3d3936; font-family: Montserrat;">'+ (place_name!="" ? place_name:'') + '</strong><br>' +
                             '<span style="color: #907C6A; font-family: Montserrat;">' + (place.formatted_address || place.name || '') + '</span>' +
                             '<br><button id="directions-button" onclick="getDirections(' + place.geometry.location.lat() + ',' +
                             place.geometry.location.lng() + ')">Get Directions</button></div>'
                });

                const marker = new google.maps.Marker({
                    position: place.geometry.location,
                    map: mapPreview
                });

                marker.addListener('click', function() {
                    infowindow.open(mapPreview, marker);
                });

                infowindow.open(mapPreview, marker);
            } catch (error) {
                console.error('Error displaying map preview:', error);
            }
        }

        function getDirections(lat, lng) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    const url = 'https://www.google.com/maps/dir/?api=1&origin=' + userLat + ',' + userLng +
                                '&destination=' + lat + ',' + lng;
                    window.open(url, '_blank');
                }, function() {
                    alert('Could not get your location. Please enable location services.');
                });
            } else {
                alert('Geolocation is not supported by your browser.');
            }
        }
    </script>

             <!-- Replace 'YOUR_API_KEY' with your actual Google Maps API key -->
    @if($is_map_iframe_enabled && isset($map_iframe) && $map_iframe!="")
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDCDOKf62W_m9qEvNI-Ke9ZvhOGz7zupJQ&libraries=places&callback=initMap" async defer></script>
    @endif





    @if ($business->enable_pwa_business == 'on' && $plan->pwa_business == 'on')
        <script type="text/javascript">
            const container = document.querySelector("body")

            const coffees = [];

            if ("serviceWorker" in navigator) {
                window.addEventListener("load", function() {
                    navigator.serviceWorker
                        .register("{{ asset('serviceWorker.js') }}")
                        .then(res => console.log("service worker registered"))
                        .catch(err => console.log("service worker not registered", err))

                })
            }
        </script>
    @endif

    <script type="text/javascript">
        // Button click handlers - Register immediately when jQuery is ready
        // These handlers MUST be registered early to ensure they work
        $(document).ready(function() {
            console.log('Registering button click handlers...');
            
            // Handle "Share Contact" button click to open card popup
            $(document).on('click', '.our-card, .share-btn, .card-popup-trigger', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('✅ Share Contact button clicked');
                var $cardPopup = $('.card-popup');
                console.log('Card popup found:', $cardPopup.length);
                if ($cardPopup.length > 0) {
                    $cardPopup.removeAttr('style').addClass('active');
                    $('body').addClass('no-scroll');
                    $('html').addClass('modal-open');
                    console.log('✅ Card popup opened successfully');
                    // Trigger QR generation after a short delay
                    setTimeout(function() {
                        if (typeof generateQRCode === 'function') {
                            generateQRCode();
                        }
                    }, 200);
                } else {
                    console.error('❌ Card popup element not found');
                }
            });
            
            // Handle "Make Connection" button click to open contact popup
            $(document).on('click', '.our-contact, [data-target="#mycontactModal"]', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('✅ Make Connection button clicked');
                
                // Try multiple selectors to find the popup
                var $contactPopup = $('.contact-popup');
                if ($contactPopup.length === 0) {
                    $contactPopup = $('#mycontactModal');
                }
                
                console.log('Contact popup found:', $contactPopup.length);
                
                if ($contactPopup.length > 0) {
                    var popupElement = $contactPopup[0];
                    
                    // Remove inline style completely first
                    $contactPopup.removeAttr('style');
                    
                    // Add active class
                    $contactPopup.addClass('active');
                    
                    // Force ALL display properties with !important using native DOM
                    popupElement.style.setProperty('display', 'block', 'important');
                    popupElement.style.setProperty('opacity', '1', 'important');
                    popupElement.style.setProperty('visibility', 'visible', 'important');
                    popupElement.style.setProperty('z-index', '99999', 'important');
                    popupElement.style.setProperty('position', 'fixed', 'important');
                    popupElement.style.setProperty('top', '0', 'important');
                    popupElement.style.setProperty('left', '0', 'important');
                    popupElement.style.setProperty('right', '0', 'important');
                    popupElement.style.setProperty('bottom', '0', 'important');
                    popupElement.style.setProperty('width', '100%', 'important');
                    popupElement.style.setProperty('height', '100%', 'important');
                    popupElement.style.setProperty('background', 'rgba(0, 0, 0, 0.7)', 'important');
                    
                    // Ensure inner container is visible and properly styled
                    var $innerContainer = $contactPopup.find('.container');
                    if ($innerContainer.length > 0) {
                        $innerContainer.css({
                            'position': 'relative',
                            'z-index': '100000',
                            'max-width': '600px',
                            'margin': '50px auto',
                            'padding': '20px 15px'
                        });
                    }
                    
                    $('body').addClass('no-scroll');
                    $('html').addClass('modal-open');
                    
                    // Force a reflow to ensure styles are applied
                    popupElement.offsetHeight;
                    
                    // Scroll popup into view if needed
                    popupElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Verify it's visible
                    setTimeout(function() {
                        var isVisible = $contactPopup.is(':visible');
                        var computedStyle = window.getComputedStyle(popupElement);
                        var rect = popupElement.getBoundingClientRect();
                        
                        console.log('✅ Contact popup opened');
                        console.log('Is visible:', isVisible);
                        console.log('Computed display:', computedStyle.display);
                        console.log('Computed opacity:', computedStyle.opacity);
                        console.log('Computed visibility:', computedStyle.visibility);
                        console.log('Computed z-index:', computedStyle.zIndex);
                        console.log('Computed position:', computedStyle.position);
                        console.log('Bounding rect:', rect);
                        console.log('Final style:', popupElement.style.cssText);
                        console.log('Final classes:', popupElement.className);
                        console.log('Popup dimensions:', popupElement.offsetWidth + 'x' + popupElement.offsetHeight);
                        
                        // If still not visible, try one more time with even more force
                        if (!isVisible || computedStyle.display === 'none' || computedStyle.opacity === '0') {
                            console.warn('⚠️ Popup still not visible, applying emergency styles...');
                            popupElement.style.cssText = 'display: block !important; opacity: 1 !important; visibility: visible !important; z-index: 99999 !important; position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; width: 100% !important; height: 100% !important; background: rgba(0, 0, 0, 0.7) !important; overflow: auto !important;';
                        }
                    }, 100);
                } else {
                    console.error('❌ Contact popup element not found');
                    console.log('Available elements with class contact-popup:', $('.contact-popup').length);
                    console.log('Available elements with id mycontactModal:', $('#mycontactModal').length);
                }
            });
            
            console.log('✅ Button handlers registered successfully');
        });
        
        // Only initialize social sharing plugin if it exists and element is present
        $(document).ready(function() {
            var $demoElement = $('#Demo');
            if ($demoElement.length > 0 && typeof $.fn.socialSharingPlugin === 'function') {
                try {
                    $demoElement.socialSharingPlugin({
                        urlShare: window.location.href,
                        description: $('meta[name=description]').attr('content') || '',
                        title: $('title').text() || ''
                    });
                } catch (e) {
                    console.warn('socialSharingPlugin initialization error:', e);
                }
            } else {
                if ($demoElement.length === 0) {
                    console.warn('socialSharingPlugin: #Demo element not found - skipping initialization');
                } else {
                    console.warn('socialSharingPlugin not available - skipping initialization');
                }
            }
            
        });
    </script>
    <script>
        $(".imagepopup").on("click", function(e) {
            var imgsrc = $(this).children(".imageresource").attr("src");
            $('.imagepreview').attr('src',
            imgsrc); // here asign the image to the modal when the user click the enlarge link
            $("#gallerymodel").addClass("active");
            $("body").toggleClass("no-scroll");
            $('html').addClass('modal-open');
            $('#gallerymodel').css("background", 'rgb(0 0 0 / 50%)')
        });

        $(".imagepopup1").on("click", function() {
            var imgsrc1 = $(this).children(".imageresource1").attr("src");
            $('.imagepreview').attr('src',
            imgsrc1); // here asign the image to the modal when the user click the enlarge link
            $("#gallerymodel").addClass("active");
            $("body").toggleClass("no-scroll");
            $('html').addClass('modal-open');
            $('#gallerymodel').css("background", 'rgb(0 0 0 / 50%)')
        });

        $(".videopop").on("click", function() {
            var videosrc = $(this).children('video').children(".videoresource").attr("src");
            $('.videopreview').attr('src',
            videosrc); // here asign the image to the modal when the user click the enlarge link
            $("#videomodel").addClass("active");
            $("body").toggleClass("no-scroll");
            $('html').addClass('modal-open');
            $('#videomodel').css("background",
                'rgb(0 0 0 / 50%)') // imagemodal is the id attribute assigned to the bootstrap modal, then i use the show function
        });

        $(".videopop1").on("click", function() {
            var videosrc1 = $(this).children('video').children(".videoresource1").attr("src");
            $('.videopreview').attr('src',
            videosrc1); // here asign the image to the modal when the user click the enlarge link
            $("#videomodel").addClass("active");
            $("body").toggleClass("no-scroll");
            $('html').addClass('modal-open');
            $('#videomodel').css("background",
                'rgb(0 0 0 / 50%)') // imagemodal is the id attribute assigned to the bootstrap modal, then i use the show function
        });

        $(".close-model").on("click", function() {
            $("#gallerymodel").removeClass("active");
            $("body").removeClass("no-scroll");
            $('html').removeClass('modal-open');
            $('#gallerymodel').css("background", '')
        });

        $(".close-model1").on("click", function() {
            $("#videomodel").removeClass("active");
            $("body").removeClass("no-scroll");
            $('html').removeClass('modal-open');
            $('#videomodel').css("background", '')
        });

        $(document).ready(function() {
                 const companyMapIfram = {{ $specificCompanyAndTheme['map_iframe'] ?? 'null' }};
                 const companyTheme = '{{ $specificCompanyAndTheme['theme'] ?? '' }}';
                 if (companyMapIfram == 1 && companyTheme === 'theme19') {
                 // Restore theme colors - let CSS handle button colors via variables
                 // The .more-card-second-section .more-card-btn .btn already uses var(--theme-color) in CSS
                 $('#view_css .client-contact .contactlink a .contact-text span').css('font-size', '15px');
                 // Use theme color for read-more-btn if needed, otherwise let CSS handle it
                 const viewCss = document.querySelector('#view_css');
                 if (viewCss) {
                     const themeColor = getComputedStyle(viewCss).getPropertyValue('--theme-color');
                     const whiteColor = getComputedStyle(viewCss).getPropertyValue('--white') || '#ffffff';
                     
                     // Apply theme color to read-more-btn using native style (since jQuery .css() doesn't handle CSS variables well)
                     document.querySelectorAll('#view_css .read-more-btn').forEach(function(btn) {
                         btn.style.setProperty('background', themeColor || 'var(--theme-color)');
                         btn.style.setProperty('color', whiteColor || 'var(--white)');
                     });
                     
                     document.querySelectorAll('#view_css .read-more-btn svg path').forEach(function(path) {
                         path.style.setProperty('fill', whiteColor || 'var(--white)');
                     });
                 }
               }
    
    
            var date = new Date();
            $('.datepicker_min').pickadate({
                min: date,
            })
        });

        //Password Check
        @if (!Auth::check())
            let ispassword;
            var ispassenable = '{{ $business->enable_password }}';
            var business_password = '{{ $business->password }}';

            if (ispassenable == 'on') {
                $('.password-submit').click(function() {

                    ispassword = 'true';
                    passwordpopup('true');
                });

                function passwordpopup(type) {
                    if (type == 'false') {

                        $("#passwordmodel").addClass("active");
                        $("body").toggleClass("no-scroll");
                        $('html').addClass('modal-open');
                        $('#passwordmodel').css("background", 'rgb(0 0 0 / 50%)')
                    } else {

                        var password_val = $('.password_val').val();

                        if (password_val == business_password) {
                            $("#passwordmodel").removeClass("active");
                            $("body").removeClass("no-scroll");

                            $('html').removeClass('modal-open');
                            $('#passwordmodel').css("background", '')
                            // $('#passwordmodel').modal('hide');
                            // $('html').removeClass('modal-open');
                            // $('.modal-backdrop').remove();
                        } else {

                            $(`.span-error-password`).text("{{ __('*Please enter correct password') }}");
                            passwordpopup('false');

                        }
                    }
                }
                if (ispassword == undefined) {

                    passwordpopup('false');
                }
            }
        @endif

        $(document).ready(function() {
            try {
            $(`.span-error-date`).text("");
            $(`.span-error-time`).text("");
            $(`.span-error-name`).text("");
            $(`.span-error-email`).text("");
            var slug = '{{ $business->slug }}';
            var url_link = `{{ url('/') }}/${slug}`;
            $(`.qr-link`).text(url_link);
            
            // ========== FORCE DEBUG MODE ==========
            window.QR_DEBUG = true;
            console.log('========================================');
            console.log('🔍 QR CODE FORCE DEBUG MODE ENABLED');
            console.log('========================================');
            console.log('URL to encode:', url_link);
            console.log('jQuery available:', typeof $ !== 'undefined');
            console.log('jQuery version:', typeof $ !== 'undefined' ? $.fn.jquery : 'N/A');
            console.log('QR container selector:', '.shareqrcode');
            console.log('QR container exists:', $('.shareqrcode').length > 0);
            console.log('QR container HTML:', $('.shareqrcode').length > 0 ? $('.shareqrcode')[0].outerHTML : 'NOT FOUND');
            console.log('Document ready state:', document.readyState);
            console.log('Window loaded:', typeof window.addEventListener !== 'undefined');
            
            // Global QR generation flag
            window.qrCodeGenerated = false;
            window.qrGenerationAttempts = 0;
            
            // ROBUST QR CODE GENERATION with multiple fallbacks
            function generateQRCode() {
                window.qrGenerationAttempts++;
                console.log('========================================');
                console.log('🚀 generateQRCode() CALLED - Attempt #' + window.qrGenerationAttempts);
                console.log('========================================');
                
                var $qrContainer = $('.shareqrcode');
                console.log('Container check:', {
                    exists: $qrContainer.length > 0,
                    length: $qrContainer.length,
                    element: $qrContainer.length > 0 ? $qrContainer[0] : null,
                    parent: $qrContainer.length > 0 ? $qrContainer[0].parentElement : null
                });
                
                if (!$qrContainer || $qrContainer.length === 0) {
                    console.error('❌ QR container .shareqrcode NOT FOUND in DOM');
                    console.log('Available elements with "qr" in class:', $('[class*="qr"]').length);
                    console.log('Available elements with "share" in class:', $('[class*="share"]').length);
                    return false;
                }
                
                // Clear container and ensure responsive styling
                console.log('Clearing container and setting styles...');
                $qrContainer.empty();
                // Show loading indicator
                $('#qr-loading-indicator').show();
                $qrContainer.css({
                    'display': 'flex',
                    'align-items': 'center',
                    'justify-content': 'center',
                    'min-height': '200px',
                    'width': '100%',
                    'max-width': '100%',
                    'background-color': '#ffffff',
                    'border': '1px solid #ddd'
                });
                console.log('Container styles applied');
                
                var qrGenerated = false;
                var qrMethod = '';
                
                // Method 1: Try backend QR code image if available
                @if(isset($qr_detail->image) && !empty($qr_detail->image))
                    @php
                        $qrImagePath = 'qrcode/' . $qr_detail->image;
                        $qrFullPath = storage_path('app/public/' . $qrImagePath);
                        $qrExists = file_exists($qrFullPath);
                        $qrUrl = $qrExists ? asset(Storage::url($qrImagePath)) : '';
                    @endphp
                    @if($qrExists && !empty($qrUrl))
                        var backendQrPath = '{{ $qrUrl }}';
                        var backendImg = new Image();
                        var backendTimeout = setTimeout(function() {
                            if (!qrGenerated) {
                                console.warn('⚠️ Backend QR image load timeout, trying API fallback');
                                backendImg.onerror = null; // Prevent double error handling
                                tryAPIGeneration();
                            }
                        }, 3000); // 3 second timeout
                        
                        backendImg.onload = function() {
                            clearTimeout(backendTimeout);
                            if (!qrGenerated) {
                                qrGenerated = true;
                                qrMethod = 'backend';
                                $qrContainer.empty().append(backendImg);
                                backendImg.style.cssText = 'max-width:100%;height:auto;display:block;margin:0 auto;width:100%;object-fit:contain;';
                                console.log('✅ QR Code Generated Successfully - Method: Backend Image');
                            }
                        };
                        backendImg.onerror = function() {
                            clearTimeout(backendTimeout);
                            console.warn('⚠️ Backend QR image not found (' + backendQrPath + '), trying API fallback');
                            tryAPIGeneration();
                        };
                        backendImg.src = backendQrPath;
                    @else
                        // Backend image file doesn't exist, use API generation
                        console.log('ℹ️ Backend QR image file not found, using API generation');
                        tryAPIGeneration();
                    @endif
                @else
                    // No backend image configured, try API generation directly
                    console.log('ℹ️ No backend QR image configured, using API generation');
                    tryAPIGeneration();
                @endif
                
                // Method 2: API-based QR generation (QRServer.com) - FORCE METHOD
                function tryAPIGeneration() {
                    console.log('🌐 tryAPIGeneration() CALLED');
                    if (qrGenerated) {
                        console.log('⚠️ QR already generated, skipping API');
                        return;
                    }
                    
                var qrSize = 250;
                var qrUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=' + qrSize + 'x' + qrSize + '&data=' + encodeURIComponent(url_link);
                
                // ALWAYS USE BLACK FOREGROUND FOR QR CODE
                var foreground_color_hex = '000000'; // Black
                var background_color_hex = 'ffffff'; // White
                
                @if (isset($plan->enable_qr_code) && $plan->enable_qr_code == 'on' && isset($qr_detail->foreground_color))
                    // Use custom colors if configured, but ensure black if not set
                    foreground_color_hex = '{{ str_replace("#", "", $qr_detail->foreground_color) }}' || '000000';
                    background_color_hex = '{{ isset($qr_detail->background_color) ? str_replace("#", "", $qr_detail->background_color) : "ffffff" }}';
                @endif
                
                qrUrl += '&color=' + foreground_color_hex + '&bgcolor=' + background_color_hex;
                console.log('QR colors:', {fg: foreground_color_hex, bg: background_color_hex});
                    
                    console.log('📡 API URL:', qrUrl);
                    console.log('📡 Encoded URL:', encodeURIComponent(url_link));
                    
                    var apiImg = document.createElement('img');
                    apiImg.src = qrUrl;
                    apiImg.alt = 'QR Code';
                    apiImg.style.cssText = 'max-width:100%;height:auto;display:block;margin:0 auto;width:100%;object-fit:contain;';
                    apiImg.setAttribute('data-debug', 'api-qr-image');
                    
                    var apiTimeout = setTimeout(function() {
                        if (!qrGenerated) {
                            console.warn('⏱️ API QR generation timeout after 5s, trying client-side fallback');
                            apiImg.onerror = null;
                            apiImg.onload = null;
                            tryClientSideGeneration();
                        }
                    }, 5000); // 5 second timeout
                    
                    apiImg.onload = function() {
                        clearTimeout(apiTimeout);
                        console.log('✅ API Image loaded successfully');
                        if (!qrGenerated) {
                            qrGenerated = true;
                            window.qrCodeGenerated = true;
                            qrMethod = 'api';
                            $('#qr-loading-indicator').hide();
                            $qrContainer.empty().append(apiImg);
                            console.log('✅✅✅ QR Code Generated Successfully - Method: API (QRServer.com)');
                            console.log('Image dimensions:', apiImg.naturalWidth + 'x' + apiImg.naturalHeight);
                        }
                    };
                    
                    apiImg.onerror = function(e) {
                        clearTimeout(apiTimeout);
                        console.error('❌ API QR generation failed:', e);
                        console.error('Failed URL:', qrUrl);
                        console.warn('⚠️ Trying client-side fallback...');
                        tryClientSideGeneration();
                    };
                    
                    // Append to container
                    if ($qrContainer.length > 0 && $qrContainer[0]) {
                        console.log('📦 Appending API image to container');
                        $qrContainer[0].appendChild(apiImg);
                        console.log('Container children after append:', $qrContainer[0].children.length);
                    } else {
                        console.error('❌ QR container not available for API image');
                        tryClientSideGeneration();
                    }
                }
                
                // Method 3: Client-side QR generation using jQuery QRCode plugin
                function tryClientSideGeneration() {
                    if (qrGenerated) return;
                    
                    // Wait a bit for libraries to load if needed
                    var attempts = 0;
                    var maxAttempts = 5;
                    
                    function attemptGeneration() {
                        attempts++;
                        
                        // Try jQuery QRCode plugin first (most reliable)
                        if (typeof jQuery !== 'undefined' && typeof jQuery.fn.qrcode !== 'undefined') {
                            try {
                                $qrContainer.empty();
                                var qrOptions = {
                                    text: url_link,
                                    width: 250,
                                    height: 250,
                                    render: 'canvas',
                                    fill: '#000000',  // ALWAYS BLACK
                                    background: '#ffffff'  // ALWAYS WHITE
                                };
                                
                                @if (isset($plan->enable_qr_code) && $plan->enable_qr_code == 'on' && isset($qr_detail->foreground_color))
                                    // Use custom colors if configured, but default to black
                                    if (typeof jQuery.fn.qrcode.defaults !== 'undefined') {
                                        qrOptions.fill = '{{ $qr_detail->foreground_color }}' || '#000000';
                                        qrOptions.background = '{{ isset($qr_detail->background_color) ? $qr_detail->background_color : "#ffffff" }}';
                                    }
                                @endif
                                
                                console.log('jQuery QRCode options:', qrOptions);
                                
                                $qrContainer.qrcode(qrOptions);
                                // Ensure canvas is responsive
                                $qrContainer.find('canvas').css({
                                    'max-width': '100%',
                                    'height': 'auto',
                                    'width': '100%'
                                });
                                qrGenerated = true;
                                qrMethod = 'jquery-plugin';
                                console.log('✅ QR Code Generated Successfully - Method: jQuery QRCode Plugin');
                                return;
                            } catch (e) {
                                console.warn('⚠️ jQuery QRCode plugin error:', e);
                            }
                        }
                        
                        // Try QRCode.js library (alternative)
                        if (typeof QRCode !== 'undefined') {
                            try {
                                $qrContainer.empty();
                                if ($qrContainer.length > 0 && $qrContainer[0]) {
                                    var qrElement = document.createElement('div');
                                    $qrContainer[0].appendChild(qrElement);
                                    // ALWAYS USE BLACK FOREGROUND
                                    var qrColorDark = '#000000'; // Black
                                    var qrColorLight = '#ffffff'; // White
                                    
                                    @if(isset($plan->enable_qr_code) && $plan->enable_qr_code == 'on' && isset($qr_detail->foreground_color))
                                        qrColorDark = '{{ $qr_detail->foreground_color }}' || '#000000';
                                        qrColorLight = '{{ isset($qr_detail->background_color) ? $qr_detail->background_color : "#ffffff" }}';
                                    @endif
                                    
                                    console.log('QRCode.js colors:', {dark: qrColorDark, light: qrColorLight});
                                    
                                    new QRCode(qrElement, {
                                        text: url_link,
                                        width: 250,
                                        height: 250,
                                        colorDark: qrColorDark,
                                        colorLight: qrColorLight,
                                        correctLevel: QRCode.CorrectLevel.H
                                    });
                                    // Ensure QR code is responsive
                                    $(qrElement).find('canvas, img').css({
                                    'max-width': '100%',
                                    'height': 'auto',
                                    'width': '100%'
                                });
                                qrGenerated = true;
                                qrMethod = 'qrcodejs';
                                console.log('✅ QR Code Generated Successfully - Method: QRCode.js');
                                return;
                            } catch (e) {
                                console.warn('⚠️ QRCode.js error:', e);
                            }
                        }
                        
                        // Final fallback: Use simple canvas-based QR code
                        if (!qrGenerated && attempts >= 2) {
                            try {
                                // Use a simple canvas-based approach as last resort
                                $qrContainer.empty();
                                var canvas = document.createElement('canvas');
                                canvas.width = 250;
                                canvas.height = 250;
                                canvas.style.cssText = 'max-width:100%;height:auto;display:block;margin:0 auto;width:100%;';
                                $qrContainer.append(canvas);
                                
                                // Try to use any available QR library one more time
                                if (typeof jQuery !== 'undefined' && typeof jQuery.fn.qrcode !== 'undefined') {
                                    $qrContainer.qrcode({
                                        text: url_link,
                                        width: 250,
                                        height: 250,
                                        render: 'canvas',
                                        fill: '#000000',  // ALWAYS BLACK
                                        background: '#ffffff'  // ALWAYS WHITE
                                    });
                                    qrGenerated = true;
                                    qrMethod = 'jquery-fallback';
                                    console.log('✅ QR Code Generated Successfully - Method: jQuery Fallback');
                                    return;
                                }
                            } catch (e) {
                                console.warn('⚠️ Fallback QR generation error:', e);
                            }
                        }
                        
                        // Retry if libraries not loaded yet
                        if (attempts < maxAttempts && (!qrGenerated)) {
                            setTimeout(attemptGeneration, 200);
                        } else if (!qrGenerated) {
                            console.error('❌ All QR code generation methods failed - showing URL as fallback');
                            // Show URL as text fallback
                            $qrContainer.html('<div style="text-align:center;padding:20px;"><p style="margin-bottom:10px;">QR Code unavailable</p><a href="' + url_link + '" style="word-break:break-all;color:#007bff;">' + url_link + '</a></div>');
                        }
                    }
                    
                    attemptGeneration();
                }
                
                return true;
            }
            
            // FORCE INITIALIZATION - Generate immediately
            function initQRCode() {
                console.log('=== initQRCode() CALLED ===');
                var $qrContainer = $('.shareqrcode');
                console.log('Container in initQRCode:', $qrContainer.length);
                
                if ($qrContainer.length > 0) {
                    console.log('✅ Container found, generating QR code');
                    generateQRCode();
                } else {
                    console.warn('⚠️ Container not found yet, will retry');
                }
            }
            
            // ========== FORCE GENERATE IMMEDIATELY - Multiple attempts ==========
            console.log('========================================');
            console.log('🚀 FORCE QR GENERATION - Starting immediate attempts');
            console.log('========================================');
            
            // FORCE API GENERATION FIRST (most reliable)
            function forceQRGeneration() {
                console.log('🔥 FORCE QR GENERATION CALLED');
                var $qrContainer = $('.shareqrcode');
                
                if ($qrContainer.length === 0) {
                    console.error('❌ Container still not found, will retry...');
                    return false;
                }
                
                console.log('✅ Container found, forcing API generation');
                $qrContainer.empty();
                $qrContainer.css({
                    'display': 'flex',
                    'align-items': 'center',
                    'justify-content': 'center',
                    'min-height': '200px',
                    'width': '100%',
                    'max-width': '100%',
                    'background-color': '#ffffff',
                    'border': '1px solid #ddd'
                });
                
                var qrSize = 250;
                var qrUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=' + qrSize + 'x' + qrSize + '&data=' + encodeURIComponent(url_link);
                
                // ALWAYS USE BLACK FOREGROUND FOR QR CODE
                var foreground_color_hex = '000000'; // Black
                var background_color_hex = 'ffffff'; // White
                
                @if (isset($plan->enable_qr_code) && $plan->enable_qr_code == 'on' && isset($qr_detail->foreground_color))
                    // Use custom colors if configured, but ensure black if not set
                    foreground_color_hex = '{{ str_replace("#", "", $qr_detail->foreground_color) }}' || '000000';
                    background_color_hex = '{{ isset($qr_detail->background_color) ? str_replace("#", "", $qr_detail->background_color) : "ffffff" }}';
                @endif
                
                qrUrl += '&color=' + foreground_color_hex + '&bgcolor=' + background_color_hex;
                console.log('🔥 FORCE API URL:', qrUrl);
                console.log('🔥 QR colors (FORCE):', {fg: foreground_color_hex, bg: background_color_hex});
                
                var forceImg = document.createElement('img');
                forceImg.src = qrUrl;
                forceImg.alt = 'QR Code';
                forceImg.style.cssText = 'max-width:100%;height:auto;display:block;margin:0 auto;width:100%;object-fit:contain;';
                forceImg.setAttribute('data-debug', 'force-api-qr');
                
                forceImg.onload = function() {
                    console.log('✅✅✅ FORCE QR CODE LOADED SUCCESSFULLY!');
                    window.qrCodeGenerated = true;
                    $('#qr-loading-indicator').hide();
                    $qrContainer.empty().append(forceImg);
                    console.log('QR Code displayed in container');
                };
                
                forceImg.onerror = function(e) {
                    console.error('❌ FORCE QR failed:', e);
                    console.log('Falling back to standard generation...');
                    generateQRCode();
                };
                
                $qrContainer[0].appendChild(forceImg);
                return true;
            }
            
            // Try force generation immediately
            console.log('Attempt #1: Immediate force generation');
            if (!forceQRGeneration()) {
                generateQRCode(); // Fallback to standard method
            }
            
            // Try multiple times with delays
            setTimeout(function() {
                console.log('Attempt #2: After 300ms');
                if (!window.qrCodeGenerated) {
                    if (!forceQRGeneration()) {
                        generateQRCode();
                    }
                }
            }, 300);
            
            setTimeout(function() {
                console.log('Attempt #3: After 800ms');
                if (!window.qrCodeGenerated) {
                    if (!forceQRGeneration()) {
                        generateQRCode();
                    }
                }
            }, 800);
            
            setTimeout(function() {
                console.log('Attempt #4: After 1500ms');
                if (!window.qrCodeGenerated) {
                    if (!forceQRGeneration()) {
                        generateQRCode();
                    }
                }
            }, 1500);
            
            setTimeout(function() {
                console.log('Attempt #5: After 3000ms');
                if (!window.qrCodeGenerated) {
                    console.error('❌ QR Code still not generated after 3 seconds!');
                    console.log('Final attempt with standard generation...');
                    generateQRCode();
                } else {
                    console.log('✅ QR Code successfully generated!');
                }
            }, 3000);
            
            // Watch for card-popup modal opening with aggressive monitoring
            function setupQRCodeWatcher() {
                console.log('Setting up QR code watchers...');
                
                var $cardPopup = $('.card-popup');
                console.log('Card popup element found:', $cardPopup.length);
                
                // Function to trigger QR generation when modal opens
                function triggerQRGeneration() {
                    console.log('✅ Modal opened - triggering QR generation');
                    setTimeout(function() {
                        generateQRCode();
                    }, 50);
                    setTimeout(function() {
                        generateQRCode();
                    }, 200);
                    setTimeout(function() {
                        generateQRCode();
                    }, 500);
                }
                
                if ($cardPopup.length) {
                    // MutationObserver for class changes
                    var observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                                if ($cardPopup.hasClass('active')) {
                                    triggerQRGeneration();
                                }
                            }
                        });
                    });
                    
                    observer.observe($cardPopup[0], {
                        attributes: true,
                        attributeFilter: ['class']
                    });
                    
                    // Direct click handler on close-search button (back arrow)
                    $(document).on('click', '.close-search', function() {
                        setTimeout(function() {
                            if ($cardPopup.hasClass('active')) {
                                triggerQRGeneration();
                            }
                        }, 100);
                    });
                    
                    // Check periodically if modal is active
                    setInterval(function() {
                        if ($cardPopup.hasClass('active')) {
                            var $qrContainer = $('.shareqrcode');
                            if ($qrContainer.length > 0 && ($qrContainer.is(':empty') || $qrContainer.children().length === 0 || $qrContainer.find('canvas').length === 0 && $qrContainer.find('img').length === 0)) {
                                console.log('Periodic check: Modal active, container empty, generating QR');
                                generateQRCode();
                            }
                        }
                    }, 1000);
                }
                
                // Also watch for CSS transitions/animations
                $cardPopup.on('transitionend', function() {
                    if ($(this).hasClass('active')) {
                        triggerQRGeneration();
                    }
                });
            }
            
            // Setup watchers after DOM is ready
            setTimeout(function() {
                setupQRCodeWatcher();
                console.log('QR watchers setup complete');
            }, 100);
            
            // Final attempt after everything loads
            $(window).on('load', function() {
                console.log('Window loaded, final QR generation attempt');
                setTimeout(function() {
                    if (!window.qrCodeGenerated) {
                        console.log('🔴 QR still not generated, forcing final attempt...');
                        forceQRGeneration();
                    } else {
                        console.log('✅ QR Code already generated!');
                    }
                }, 500);
            });
            
            // Final summary after 5 seconds
            setTimeout(function() {
                console.log('========================================');
                console.log('📊 QR CODE GENERATION SUMMARY');
                console.log('========================================');
                console.log('Total attempts:', window.qrGenerationAttempts);
                console.log('QR Code generated:', window.qrCodeGenerated);
                console.log('Container exists:', $('.shareqrcode').length > 0);
                console.log('Container has children:', $('.shareqrcode').length > 0 ? $('.shareqrcode')[0].children.length : 0);
                console.log('Container HTML:', $('.shareqrcode').length > 0 ? $('.shareqrcode')[0].innerHTML.substring(0, 200) : 'NOT FOUND');
                if (!window.qrCodeGenerated) {
                    console.error('❌❌❌ QR CODE FAILED TO GENERATE AFTER ALL ATTEMPTS ❌❌❌');
                    console.log('Please check the console for errors above');
                } else {
                    console.log('✅✅✅ QR CODE SUCCESSFULLY GENERATED ✅✅✅');
                }
                console.log('========================================');
            }, 5000);
            
            } catch (error) {
                console.error('❌ CRITICAL ERROR in QR code generation:', error);
                console.error('Error stack:', error.stack);
                // Try to generate QR code anyway using simple method
                setTimeout(function() {
                    var $qrContainer = $('.shareqrcode');
                    if ($qrContainer.length > 0) {
                        var qrUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=' + encodeURIComponent(url_link);
                        var img = document.createElement('img');
                        img.src = qrUrl;
                        img.style.cssText = 'max-width:100%;height:auto;display:block;margin:0 auto;';
                        $qrContainer[0].appendChild(img);
                        console.log('Emergency QR code generation attempted');
                    }
                }, 1000);
            }
        });

        $(`.rating_preview`).attr('id');
        var from_$input = $('#input_from').pickadate(),
            from_picker = from_$input.pickadate('picker');

        var to_$input = $('#input_to').pickadate(),
            to_picker = to_$input.pickadate('picker');

        var is_enabled = "{{ $is_enable }}";
        if (is_enabled) {
            $('#business-hours-div').show();
        } else {
            $('#business-hours-div').hide();
        }

        var is_contact_enable = "{{ $is_contact_enable }}";
        if (is_contact_enable) {
            $('#contact-div').show();
            $('#contact-div1').show();

        } else {
            $('#contact-div').hide();
            $('#contact-div1').hide();
        }

        var is_enable_appoinment = "{{ $is_enable_appoinment }}";
        if (is_enable_appoinment) {
            $('#appointment-div').show();
        } else {
            $('#appointment-div').hide();
        }

        var is_enable_service = "{{ $is_enable_service }}";
        if (is_enable_service) {
            $('#services-div').show();
        } else {
            $('#services-div').hide();
        }
        var is_enable_product = "{{ $is_enable_product }}";
        if (is_enable_product) {
            $('#product-div').show();
        } else {
            $('#product-div').hide();
        }

        var is_enable_testimonials = "{{ $is_enable_testimonials }}";
        if (is_enable_testimonials) {
            $('#testimonials-div').show();
        } else {
            $('#testimonials-div').hide();
        }

        var is_enable_sociallinks = "{{ $is_enable_sociallinks }}";
        if (is_enable_sociallinks) {
            $('#social-div').show();

        } else {
            $('#social-div').hide();
        }

        var is_enable_sociallinks = "{{ $is_enable_sociallinks }}";
        if (is_enable_sociallinks) {
            $('#social1-div').show();

        } else {
            $('#social1-div').hide();
        }

        var is_custom_html_enable = "{{ $is_custom_html_enable }}";
        if (is_custom_html_enable) {
            $('.custom_html_text').show();
        } else {
            $('.custom_html_text').hide();
        }

        var is_branding_enable = "{{ $is_branding_enabled }}";
        if (is_branding_enable) {
            $('.branding_text').show();
        } else {
            $('.branding_text').hide();
        }
        var is_enable_gallery = "{{ $is_enable_gallery }}";
        if (is_enable_gallery) {
            $('#gallery-div').show();
        } else {
            $('#gallery-div').hide();
        }

        $(`#makeappointment`).click(function() {
            $(`.span-error-date`).text("");
            $(`.span-error-time`).text("");
            $(`.span-error-name`).text("");
            $(`.span-error-email`).text("");

            var name = $(`.app_name`).val();
            var email = $(`.app_email`).val();
            var date = $(`.datepicker_min`).val();
            var phone = $(`.app_phone`).val();
            var time = $(".time").val();
            var business_id = '{{ $business->id }}';

            function formatDate(date) {
                var d = new Date(date),
                    month = '' + (d.getMonth() + 1),
                    day = '' + d.getDate(),
                    year = d.getFullYear();

                if (month.length < 2)
                    month = '0' + month;
                if (day.length < 2)
                    day = '0' + day;

                return [year, month, day].join('-');
            }
            if (date == "") {
                $(`.span-error-date`).text("{{ __('*Please choose date') }}");
                $(".close-search").trigger({
                    type: "click"
                });
            } else if (document.querySelectorAll('.time').length < 1 || time == 'Select hour') {
                $(`.span-error-time`).text("{{ __('*Please choose time') }}");
                $(".close-search").trigger({
                    type: "click"
                });
            } else if (name == "") {
                $(`.span-error-name`).text("{{ __('*Please enter your name') }}");
            } else if (email == "") {
                $(`.span-error-email`).text("{{ __('*Please enter your email') }}");
            } else if (phone == "") {
                //alert("DSfgbn");
                $(`.span-error-phone`).text("{{ __('*Please enter your phone no.') }}");
            } else {
                $(`.span-error-date`).text("");
                $(`.span-error-time`).text("");
                $(`.span-error-name`).text("");
                $(`.span-error-email`).text("");
                date = formatDate(date);
                $.ajax({
                    url: '{{ route('appoinment.store') }}',
                    type: 'POST',
                    data: {
                        "name": name,
                        "email": email,
                        "phone": phone,
                        "date": date,
                        "time": time,
                        "business_id": business_id,
                        "_token": "{{ csrf_token() }}",
                        "name": name,
                        "email": email,
                        "date": date,
                        "time": time,
                        "business_id": business_id,
                        "_token": "{{ csrf_token() }}",
                    },
                    success: function(data) {
                        if (data.flag == false) {
                            $(".close-search").trigger({
                                type: "click"
                            });
                            show_toastr('Error', data.msg, 'error');

                        } else {
                            $(".close-search").trigger({
                                type: "click"
                            });
                            setTimeout(function() {
                                location.reload();
                            }, 1500);
                            show_toastr('Success',
                                "{{ __('Thank you for booking an appointment.') }}", 'success');
                        }
                    }
                });
            }
        });

        $(`#makecontact`).click(function() {
            var name = $(`.contact_name`).val();
            var email = $(`.contact_email`).val();
            var phone = $(`.contact_phone`).val();
            var message = $(`.contact_message`).val();
            var business_id = '{{ $business->id }}';

            $(`.span-error-contactname`).text("");
            $(`.span-error-contactemail`).text("");
            $(`.span-error-contactphone`).text("");
            $(`.span-error-contactmessage`).text("");

            if (name == "") {
                $(`.span-error-contactname`).text("{{ __('*Please enter your name') }}");
            } else if (email == "") {
                $(`.span-error-contactemail`).text("{{ __('*Please enter your email') }}");
            } else if (phone == "") {
                $(`.span-error-contactphone`).text("{{ __('*Please enter your phone no.') }}");
            } else if (message == "") {
                $(`.span-error-contactmessage`).text("{{ __('*Please enter your message.') }}");
            } else {

                $(`.span-error-contactname`).text("");
                $(`.span-error-contactemail`).text("");
                $(`.span-error-contactphone`).text("");
                $(`.span-error-contactmessage`).text("");

                $.ajax({
                    url: '{{ route('contacts.store') }}',
                    type: 'POST',
                    data: {
                        "name": name,
                        "email": email,
                        "phone": phone,
                        "message": message,
                        "business_id": business_id,
                        "_token": "{{ csrf_token() }}",
                    },
                    success: function(data) {
                        // Close the contact popup
                        $('.contact-popup').removeClass('active').attr('style', 'display: none;');
                        $('body').removeClass('no-scroll');
                        $('html').removeClass('modal-open');
                        
                        setTimeout(function() {
                            location.reload();
                        }, 1500);
                        show_toastr('Success', "{{ __('Your contact details has been noted.') }}",
                            'success');

                    }
                });
            }
        });
    </script>
    <!-- Google Analytic Code -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ $business->google_analytic }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', '{{ $business->google_analytic }}');
    </script>
    @if (isset($is_slug))
        <script>
            function show_toastr(title, message, type) {
                var o, i;
                var icon = '';
                var cls = '';

                if (type == 'success') {
                    icon = 'ti ti-check-circle';
                    cls = 'success';
                } else {
                    icon = 'ti ti-times-circle';
                    cls = 'danger';
                }

                $.notify({
                    icon: icon,
                    title: " " + title,
                    message: message,
                    url: ""
                }, {
                    element: "body",
                    type: cls,
                    allow_dismiss: !0,
                    placement: {
                        from: 'top',
                        align: 'right'
                    },
                    offset: {
                        x: 15,
                        y: 15
                    },
                    spacing: 80,
                    z_index: 1080,
                    delay: 2500,
                    timer: 2000,
                    url_target: "_blank",
                    mouse_over: !1,
                    animate: {
                        enter: o,
                        exit: i
                    },
                    template: '<div class="alert alert-{0} alert-icon alert-group alert-notify" data-notify="container" role="alert"><div class="alert-group-prepend alert-content"><span class="alert-group-icon"><i data-notify="icon"></i></span></div><div class="alert-content"><strong data-notify="title">{1}</strong><div data-notify="message">{2}</div></div><button type="button" class="close" data-notify="dismiss" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'
                });
            }
            if ($(".datepicker").length) {
                $('.datepicker').daterangepicker({
                    singleDatePicker: true,
                    format: 'yyyy-mm-dd',
                });
            }
        </script>
    
        @if ($message = Session::get('success'))
            <script>
                show_toastr('Success', {{ json_encode($message) }}, 'success');
            </script>
        @endif
        @if ($message = Session::get('error'))
            <script>
                show_toastr('Error', {{ json_encode($message) }}, 'error');
            </script>
        @endif
    @endif
    <!-- Facebook Pixel Code -->
    @if(!empty($business->fbpixel_code))
    <script>
        ! function(f, b, e, v, n, t, s) {
            if (f.fbq) return;
            n = f.fbq = function() {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n;
            n.push = n;
            n.loaded = !0;
            n.version = '2.0';
            n.queue = [];
            t = b.createElement(e);
            t.async = !0;
            t.src = v;
            s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '{{ $business->fbpixel_code }}');
        fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
            src="https://www.facebook.com/tr?id={{ $business->fbpixel_code }}&ev=PageView&noscript=1" /></noscript>
    @endif

    <!-- Custom Code -->
    @if(!empty($business->customjs))
    <script type="text/javascript">
        {!! $business->customjs !!}
    </script>
    @endif
    @if (isset($is_pdf))
        @include('business.script');
    @endif
    @if (isset($is_slug))
        @if ($is_gdpr_enabled)
            <script src="{{ asset('js/cookieconsent.js') }}"></script>
            <script>
                let myVar = {!! json_encode($a) !!};
                let data = JSON.parse(myVar);
                let language_code = document.documentElement.getAttribute('lang');
                let languages = {};
                languages[language_code] = {
                    consent_modal: {
                        title: 'hello',
                        description: 'description',
                        primary_btn: {
                            text: 'primary_btn text',
                            role: 'accept_all'
                        },
                        secondary_btn: {
                            text: 'secondary_btn text',
                            role: 'accept_necessary'
                        }
                    },
                    settings_modal: {
                        title: 'settings_modal',
                        save_settings_btn: 'save_settings_btn',
                        accept_all_btn: 'accept_all_btn',
                        reject_all_btn: 'reject_all_btn',
                        close_btn_label: 'close_btn_label',
                        blocks: [{
                                title: 'block title',
                                description: 'block description'
                            },

                            {
                                title: 'title',
                                description: 'description',
                                toggle: {
                                    value: 'necessary',
                                    enabled: true,
                                    readonly: false
                                }
                            },
                        ]
                    }
                };
            </script>
            <script>
                function setCookie(cname, cvalue, exdays) {
                    const d = new Date();
                    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                    let expires = "expires=" + d.toUTCString();
                    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
                }

                function getCookie(cname) {
                    let name = cname + "=";
                    let decodedCookie = decodeURIComponent(document.cookie);
                    let ca = decodedCookie.split(';');
                    for (let i = 0; i < ca.length; i++) {
                        let c = ca[i];
                        while (c.charAt(0) == ' ') {
                            c = c.substring(1);
                        }
                        if (c.indexOf(name) == 0) {
                            return c.substring(name.length, c.length);
                        }
                    }
                    return "";
                }


                // obtain plugin
                var cc = initCookieConsent();
                // run plugin with your configuration
                cc.run({
                    current_lang: 'en',
                    autoclear_cookies: true, // default: false
                    page_scripts: true,
                    // ...
                    gui_options: {
                        consent_modal: {
                            layout: 'cloud', // box/cloud/bar
                            position: 'bottom center', // bottom/middle/top + left/right/center
                            transition: 'slide', // zoom/slide
                            swap_buttons: false // enable to invert buttons
                        },
                        settings_modal: {
                            layout: 'box', // box/bar
                            // position: 'left',           // left/right
                            transition: 'slide' // zoom/slide
                        }
                    },

                    onChange: function(cookie, changed_preferences) {},
                    onAccept: function(cookie) {
                        if (!getCookie('cookie_consent_logged')) {
                            var cookie = cookie.level;
                            var slug = '{{ $business->slug }}';
                            $.ajax({
                                url: '{{ route('card-cookie-consent') }}',
                                datType: 'json',
                                data: {
                                    cookie: cookie,
                                    slug: slug,
                                },
                            })
                            setCookie('cookie_consent_logged', '1', 182, '/');
                        }
                    },
                    languages: {
                        'en': {
                            consent_modal: {
                                title: data.cookie_title,
                                description: data.cookie_description + ' ' +
                                    '<button type="button" data-cc="c-settings" class="cc-link">Let me choose</button>',
                                primary_btn: {
                                    text: "{{ __('Accept all') }}",
                                    role: 'accept_all' // 'accept_selected' or 'accept_all'
                                },
                                secondary_btn: {
                                    text: "{{ __('Reject all') }}",
                                    role: 'accept_necessary' // 'settings' or 'accept_necessary'
                                },
                            },
                            settings_modal: {
                                title: "{{ __('Cookie preferences') }}",
                                save_settings_btn: "{{ __('Save settings') }}",
                                accept_all_btn: "{{ __('Accept all') }}",
                                reject_all_btn: "{{ __('Reject all') }}",
                                close_btn_label: "{{ __('Close') }}",
                                cookie_table_headers: [{
                                        col1: 'Name'
                                    },
                                    {
                                        col2: 'Domain'
                                    },
                                    {
                                        col3: 'Expiration'
                                    },
                                    {
                                        col4: 'Description'
                                    }
                                ],
                                blocks: [{
                                    title: data.cookie_title + ' ' + '📢',
                                    description: data.cookie_description,
                                }, {
                                    title: data.strictly_cookie_title,
                                    description: data.strictly_cookie_description,
                                    toggle: {
                                        value: 'necessary',
                                        enabled: true,
                                        readonly: true // cookie categories with readonly=true are all treated as "necessary cookies"
                                    }
                                }, {
                                    title: "{{ __('More information') }}",
                                    description: data.more_information_description + ' ' +
                                        '<a class="cc-link" href="' + data.contactus_url + '">Contact Us</a>.',
                                }]
                            }
                        }
                    }

                });
            </script>
        @endif
    @endif
    <!--scripts end here-->
</body>

</html>
